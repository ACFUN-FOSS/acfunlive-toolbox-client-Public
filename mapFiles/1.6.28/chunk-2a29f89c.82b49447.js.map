{"version":3,"sources":["webpack:///./src/electron_browser/util_function/formatter.ts","webpack:///./src/electron_browser/views/roomMgmt/index.vue?9b07","webpack:///./src/electron_browser/views/roomMgmt/index.vue","webpack:///./src/electron_browser/views/roomMgmt/index.vue?c3b4","webpack:///./src/electron_browser/views/roomMgmt/index.vue?5590"],"names":["unixTimeFormatter","timestamp","zeroPadding","n","length","hour","Math","floor","minute","second","String","thousandFormatter","count","unit","toFixed","hundrenFormatter","byteFormatter","byte","shift","class","id","element-loading-text","title","roomProfile","liveCover","flex","span","style","size","placeholder","canCut","setCanCut","categoryValue","options","categoryCascade","isStreaming","type","setRoomProfile","disabled","changed","model-value","danmakuStream","append","copy","danmakuOfficial","obsSync","OBS","obs","connect","streamSession","rtmpServer","streamKey","$store","commit","streamEncodec","resolution","closeStream","loading","name","mixins","this","state","liveType","categoryID","subCategoryID","timer","window","location","origin","magicScreen","computed","userSession","userID","e","category","roomCategorys","find","roomCategory","loadCache","getCutStatus","on","openStream","setInterval","saveCache","off","emit","clearInterval","methods","then","catch","message","duration","finally","localStorage","setItem","JSON","stringify","img","cache","getItem","parse","liveID","coverFile","generateUrl","once","offset","validation","status","checkStatus","streaming","stopStream","setStreamSettings","server","key","startStream","readyToStream","error","console","confirmButtonText","setTimeout","str","dispatch","streamName","portrait","panoramic","errmsg","includes","render","__scopeId"],"mappings":"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","file":"js/chunk-2a29f89c.82b49447.js","sourcesContent":["export const unixTimeFormatter = (timestamp: number) => {\r\n\tconst zeroPadding = (n: string) => {\r\n\t\tif (n.length < 2) {\r\n\t\t\treturn `0${n}`;\r\n\t\t}\r\n\t\treturn n;\r\n\t};\r\n\ttimestamp = timestamp / 1000;\r\n\tconst hour = Math.floor(timestamp / 3600);\r\n\tconst minute = Math.floor((timestamp - hour * 3600) / 60);\r\n\tconst second = Math.floor(timestamp % 60);\r\n\treturn `${zeroPadding(String(hour))}:${zeroPadding(\r\n\t\tString(minute)\r\n\t)}:${zeroPadding(String(second))}`;\r\n};\r\nexport const thousandFormatter = (count: number, unit = \"万\"): string => {\r\n\tif (count < 10000) {\r\n\t\treturn String(count);\r\n\t}\r\n\r\n\treturn `${(count / 10000).toFixed(1)}${unit}`;\r\n};\r\n\r\nexport const hundrenFormatter = (count: number): string => {\r\n\tif (count > 10000) {\r\n\t\treturn thousandFormatter(count, \"W\");\r\n\t}\r\n\tif (count > 1000) {\r\n\t\treturn `${(count / 1000).toFixed(1)}k`;\r\n\t}\r\n\treturn String(count);\r\n};\r\n\r\nexport const byteFormatter = (byte: number): string => {\r\n\tconst unit = [\"Byte\", \"KB\", \"MB\", \"GB\", \"T\"];\r\n\twhile (byte > 1024 && unit.length > 1) {\r\n\t\tbyte /= 1024;\r\n\t\tunit.shift();\r\n\t}\r\n\treturn `${byte.toFixed(2)} ${unit[0]}`;\r\n};\r\n","export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=4617813b&scoped=true&lang=scss\"","<template>\r\n\t<content-frame\r\n\t\tid=\"roomMgmt\"\r\n\t\tv-loading=\"loading\"\r\n\t\telement-loading-text=\"推流时间从10秒到30秒不等，请耐心等待\"\r\n\t>\r\n\t\t<row-frame title=\"封面选择\">\r\n\t\t\t<row-span>\r\n\t\t\t\t<img-input-clip v-model=\"roomProfile.liveCover\" />\r\n\t\t\t\t<div class=\"hint\">（仅支持jpg、png格式，推荐比例16:10）</div>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t\t<row-frame :flex=\"true\">\r\n\t\t\t<row-span :span=\"6\">\r\n\t\t\t\t<row-frame\r\n\t\t\t\t\ttitle=\"房间标题\"\r\n\t\t\t\t\tstyle=\"width:100%;margin-bottom:0px\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<el-input\r\n\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\tplaceholder=\"请输入房间名称\"\r\n\t\t\t\t\t\tv-model=\"roomProfile.title\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</row-frame>\r\n\t\t\t</row-span>\r\n\t\t\t<row-span :span=\"6\">\r\n\t\t\t\t<row-frame\r\n\t\t\t\t\ttitle=\"允许观众剪辑\"\r\n\t\t\t\t\tstyle=\"width:100%;margin-bottom:0px\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<el-switch v-model=\"canCut\" @click=\"setCanCut\" />\r\n\t\t\t\t</row-frame>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\r\n\t\t<row-frame :flex=\"true\">\r\n\t\t\t<row-span :span=\"8\">\r\n\t\t\t\t<row-frame\r\n\t\t\t\t\ttitle=\"直播分区\"\r\n\t\t\t\t\t:flex=\"true\"\r\n\t\t\t\t\tstyle=\"width:100%;margin-bottom:0px\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<el-cascader\r\n\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\tstyle=\"width:100%\"\r\n\t\t\t\t\t\tplaceholder=\"请选择分区\"\r\n\t\t\t\t\t\tv-model=\"categoryValue\"\r\n\t\t\t\t\t\t:options=\"categoryCascade\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</row-frame>\r\n\t\t\t</row-span>\r\n\t\t\t<row-span :span=\"4\" v-if=\"isStreaming\">\r\n\t\t\t\t<row-frame\r\n\t\t\t\t\ttitle=\" \"\r\n\t\t\t\t\tstyle=\"width:100%;margin-bottom:0px;text-align:right\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<el-button\r\n\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\tclass=\"btnBase\"\r\n\t\t\t\t\t\t@click=\"setRoomProfile\"\r\n\t\t\t\t\t\t:disabled=\"changed\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t修改标题封面\r\n\t\t\t\t\t</el-button>\r\n\t\t\t\t</row-frame>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t\t<row-frame title=\"弹幕流链接\" :flex=\"true\">\r\n\t\t\t<row-span :span=\"12\">\r\n\t\t\t\t<el-input size=\"mini\" :model-value=\"danmakuStream\">\r\n\t\t\t\t\t<template #append>\r\n\t\t\t\t\t\t<el-button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\t\tclass=\"btnBase attach\"\r\n\t\t\t\t\t\t\t@click=\"copy(danmakuStream)\"\r\n\t\t\t\t\t\t\t>复制\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-input>\r\n\t\t\t\t<div class=\"hint\">（将上访链接黏贴到推流软件内置浏览器中）</div>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t\t<row-frame title=\"弹幕流链接（官方）\" :flex=\"true\">\r\n\t\t\t<row-span :span=\"12\">\r\n\t\t\t\t<el-input size=\"mini\" :model-value=\"danmakuOfficial\">\r\n\t\t\t\t\t<template #append>\r\n\t\t\t\t\t\t<el-button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\t\tclass=\"btnBase attach\"\r\n\t\t\t\t\t\t\t@click=\"copy(danmakuOfficial)\"\r\n\t\t\t\t\t\t\t>复制\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-input>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t\t<row-frame title=\"OBS同步推流\" :flex=\"true\">\r\n\t\t\t<row-span :span=\"4\">\r\n\t\t\t\t<el-checkbox v-model=\"obsSync\">启用</el-checkbox>\r\n\t\t\t</row-span>\r\n\t\t\t<row-span\r\n\t\t\t\tv-if=\"obsSync\"\r\n\t\t\t\t:class=\"OBS.obs ? 'online' : 'offline'\"\r\n\t\t\t\t:span=\"4\"\r\n\t\t\t>\r\n\t\t\t\t{{ OBS.obs ? \"OBS已连接\" : \"OBS未连接\" }}\r\n\t\t\t</row-span>\r\n\t\t\t<row-span v-if=\"obsSync\" :span=\"3\">\r\n\t\t\t\t<el-button\r\n\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\tclass=\"btnBase\"\r\n\t\t\t\t\t@click=\"OBS.connect()\"\r\n\t\t\t\t\t>连接OBS\r\n\t\t\t\t</el-button>\r\n\t\t\t</row-span>\r\n\t\t\t<div v-if=\"obsSync\" class=\"hint\">\r\n\t\t\t\t（如上方显示OBS未连接，请根据文件夹中的说明检查是否正确配置）\r\n\t\t\t</div>\r\n\t\t\t<div v-else class=\"hint\">\r\n\t\t\t\t（如需手动推流，请将下方直播地址和直播码配置到推流软件中，待下方推流状态成功后开启直播，acfun直播助手开播后工具箱会自动切换到直播状态）\r\n\t\t\t</div>\r\n\t\t</row-frame>\r\n\t\t<row-frame v-if=\"!obsSync\" title=\"RTMP服务器(Server)\" :flex=\"true\">\r\n\t\t\t<row-span :span=\"12\">\r\n\t\t\t\t<el-input size=\"mini\" :model-value=\"streamSession.rtmpServer\">\r\n\t\t\t\t\t<template #append>\r\n\t\t\t\t\t\t<el-button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\t\tclass=\"btnBase attach\"\r\n\t\t\t\t\t\t\t@click=\"copy(streamSession.rtmpServer)\"\r\n\t\t\t\t\t\t\t>复制\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-input>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t\t<row-frame\r\n\t\t\tv-if=\"!obsSync\"\r\n\t\t\ttitle=\"直播码/串流密钥(Stream Key)\"\r\n\t\t\t:flex=\"true\"\r\n\t\t>\r\n\t\t\t<row-span :span=\"9.5\">\r\n\t\t\t\t<el-input size=\"mini\" :model-value=\"streamSession.streamKey\">\r\n\t\t\t\t\t<template #append>\r\n\t\t\t\t\t\t<el-button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t\t\tclass=\"btnBase attach\"\r\n\t\t\t\t\t\t\t@click=\"copy(streamSession.streamKey)\"\r\n\t\t\t\t\t\t\t>复制\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-input>\r\n\t\t\t</row-span>\r\n\t\t\t<row-span :span=\"2\">\r\n\t\t\t\t<el-button\r\n\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t@click=\"$store.commit('getStreamSession')\"\r\n\t\t\t\t\t>刷新</el-button\r\n\t\t\t\t>\r\n\t\t\t</row-span>\r\n\t\t\t<div class=\"hint\">\r\n\t\t\t\t（考虑到用户隐私，直播码每次开播都会默认刷新）\r\n\t\t\t</div>\r\n\t\t</row-frame>\r\n\t\t<row-frame v-if=\"!obsSync\" title=\"推流状态\" :flex=\"true\">\r\n\t\t\t<row-span\r\n\t\t\t\t:class=\"streamEncodec.resolution ? 'online' : 'offline'\"\r\n\t\t\t\t:span=\"4\"\r\n\t\t\t>\r\n\t\t\t\t{{ streamEncodec.resolution ? \"推流成功\" : \"推流等待中\" }}\r\n\t\t\t</row-span>\r\n\t\t\t<row-span :span=\"2\">\r\n\t\t\t\t<el-button\r\n\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t@click=\"$store.commit('getStreamEncodec')\"\r\n\t\t\t\t\t>刷新</el-button\r\n\t\t\t\t>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t\t<row-frame title=\"下播\" v-if=\"isStreaming\" :flex=\"true\">\r\n\t\t\t<row-span :span=\"4\">\r\n\t\t\t\t<el-button\r\n\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\tclass=\"btnBase\"\r\n\t\t\t\t\t@click=\"closeStream\"\r\n\t\t\t\t\t>下播\r\n\t\t\t\t</el-button>\r\n\t\t\t</row-span>\r\n\t\t</row-frame>\r\n\t</content-frame>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { mapGetters, mapState } from \"vuex\";\r\nimport cloneDeep from \"lodash/cloneDeep\";\r\nimport { ElMessage, ElMessageBox } from \"element-plus\";\r\nimport { room } from \"@front/datas\";\r\nimport { closeStream } from \"@front/mixins/methods\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nimport { sleep, isUrl } from \"@front/util_function/base\";\r\nimport { copy } from \"@front/util_function/clipboard\";\r\nimport OBS from \"@front/util_function/obs\";\r\nimport { getCutStatus, setCutStatus } from \"@front/api/room\";\r\nexport default defineComponent({\r\n\tname: \"roomMgmt\",\r\n\tmixins: [closeStream],\r\n\tdata() {\r\n\t\tconst roomProfile: room.ProfileDetail = cloneDeep(\r\n\t\t\tthis.$store.state.roomProfile\r\n\t\t);\r\n\t\tif (roomProfile.liveType.categoryID === 0) {\r\n\t\t\troomProfile.liveType.categoryID = 1;\r\n\t\t\troomProfile.liveType.subCategoryID = 101;\r\n\t\t}\r\n\t\tconst timer: any = null;\r\n\t\treturn {\r\n\t\t\tOBS,\r\n\t\t\tobsSync: false,\r\n\t\t\tloading: false,\r\n\t\t\tcanCut: false,\r\n\t\t\tcount: 0,\r\n\t\t\ttimer,\r\n\t\t\troomProfile,\r\n\t\t\tdanmakuStream: `${window.location.origin}/obs/danmaku/`,\r\n\t\t\tmagicScreen: `${window.location.origin}/obs/screen`\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters([\"categoryCascade\", \"isStreaming\"]),\r\n\t\t...mapState([\r\n\t\t\t\"streamSession\",\r\n\t\t\t\"streamEncodec\",\r\n\t\t\t\"roomCategorys\",\r\n\t\t\t\"userSession\"\r\n\t\t]),\r\n\t\tchanged(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\tthis.roomProfile.title ===\r\n\t\t\t\t\tthis.$store.state.roomProfile.title &&\r\n\t\t\t\tthis.roomProfile.liveCover ===\r\n\t\t\t\t\tthis.$store.state.roomProfile.liveCover\r\n\t\t\t);\r\n\t\t},\r\n\t\tdanmakuOfficial(): string {\r\n\t\t\treturn `https://live.acfun.cn/room/${this.userSession.userID}?theme=default&showAuthorclubOnly=true&showAvatar=true`;\r\n\t\t},\r\n\t\tcategoryValue: {\r\n\t\t\tget(): Array<number> {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tthis.roomProfile.liveType.categoryID,\r\n\t\t\t\t\tthis.roomProfile.liveType.subCategoryID\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t\tset(e: any): void {\r\n\t\t\t\tconst subCategoryID = e[1];\r\n\t\t\t\tconst category = this.roomCategorys.find(\r\n\t\t\t\t\t(roomCategory: any) => {\r\n\t\t\t\t\t\treturn roomCategory.subCategoryID === subCategoryID;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tif (category) {\r\n\t\t\t\t\tthis.roomProfile.liveType = { ...category };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$store.commit(\"getCategory\");\r\n\t\tthis.$store.commit(\"getStreamSession\"); // get rtmp key when no streaming\r\n\t\tthis.loadCache();\r\n\t\tthis.getCutStatus();\r\n\t\tevent.on(\"openStream\", this.openStream);\r\n\t\tthis.timer = setInterval(() => {\r\n\t\t\tthis.$store.commit(\"getStreamEncodec\");\r\n\t\t}, 3000);\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tthis.saveCache();\r\n\t\tevent.off(\"openStream\", this.openStream);\r\n\t\tevent.emit(\"openStreamEnd\");\r\n\t\tclearInterval(this.timer);\r\n\t},\r\n\tmethods: {\r\n\t\tgetCutStatus() {\r\n\t\t\tgetCutStatus().then(({ canCut }) => {\r\n\t\t\t\tthis.canCut = canCut;\r\n\t\t\t});\r\n\t\t},\r\n\t\tsetCanCut() {\r\n\t\t\tsetCutStatus(this.canCut)\r\n\t\t\t\t.catch((message: any) => {\r\n\t\t\t\t\tElMessage({\r\n\t\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\t\tmessage,\r\n\t\t\t\t\t\tduration: 1500\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.finally(this.getCutStatus);\r\n\t\t},\r\n\t\tcopy,\r\n\t\tsaveCache() {\r\n\t\t\tlocalStorage.setItem(\r\n\t\t\t\t\"imgCache\",\r\n\t\t\t\tJSON.stringify({\r\n\t\t\t\t\ttitle: this.roomProfile.title,\r\n\t\t\t\t\timg: this.roomProfile.liveCover,\r\n\t\t\t\t\tcategory: this.roomProfile.liveType,\r\n\t\t\t\t\tobsSync: this.obsSync\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t},\r\n\t\tloadCache() {\r\n\t\t\tlet cache: any = localStorage.getItem(\"imgCache\");\r\n\t\t\tif (!cache) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcache = JSON.parse(cache);\r\n\t\t\tthis.roomProfile.title = cache.title;\r\n\t\t\tthis.roomProfile.liveCover = cache.img;\r\n\t\t\tthis.roomProfile.liveType = cache.category || room.category();\r\n\t\t\tthis.obsSync = cache.obsSync;\r\n\t\t},\r\n\t\tasync setRoomProfile() {\r\n\t\t\tawait this.$store.commit(\"setRoomProfile\", {\r\n\t\t\t\tliveID: this.$store.state.roomProfile.liveID,\r\n\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\r\n\t\t\t\ttitle: this.roomProfile.title\r\n\t\t\t});\r\n\t\t\tevent.once(\"roomProfileChanged\", () => {\r\n\t\t\t\tElMessage({\r\n\t\t\t\t\tmessage: \"修改成功\",\r\n\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\ttype: \"success\",\r\n\t\t\t\t\toffset: 60\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tasync openStream() {\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\r\n\t\t\t\t}, 500);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.obsSync) {\r\n\t\t\t\tconst status = await this.OBS.checkStatus();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (status?.streaming) {\r\n\t\t\t\t\t\tawait this.OBS.stopStream();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tawait sleep(2000);\r\n\t\t\t\t\tawait this.OBS.setStreamSettings({\r\n\t\t\t\t\t\tserver: this.streamSession.rtmpServer,\r\n\t\t\t\t\t\tkey: this.streamSession.streamKey\r\n\t\t\t\t\t});\r\n\t\t\t\t\tawait this.OBS.startStream();\r\n\t\t\t\t\tthis.readyToStream();\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\tElMessageBox({\r\n\t\t\t\t\t\ttitle: \"OBS启播失败\",\r\n\t\t\t\t\t\tconfirmButtonText: \"淦哦\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.readyToStream();\r\n\t\t},\r\n\t\tgenerateUrl(str: string) {\r\n\t\t\tif (isUrl(str)) {\r\n\t\t\t\treturn str;\r\n\t\t\t}\r\n\t\t\treturn `${window.location.origin}${str}`;\r\n\t\t},\r\n\t\tasync readyToStream() {\r\n\t\t\tthis.loading = true;\r\n\t\t\tif (!this?.streamEncodec?.resolution) {\r\n\t\t\t\tif (this.count < 60) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.count++;\r\n\t\t\t\t\t\tthis.readyToStream();\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tElMessage({\r\n\t\t\t\t\tmessage: \"推流未成功，请等待10秒/刷新密匙重新配置后重试\",\r\n\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\toffset: 60\r\n\t\t\t\t});\r\n\t\t\t\tthis.count = 0;\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t\tevent.emit(\"openStreamEnd\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.saveCache();\r\n\t\t\tthis.$store\r\n\t\t\t\t.dispatch(\"openStream\", {\r\n\t\t\t\t\ttitle: this.roomProfile.title,\r\n\t\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\r\n\t\t\t\t\tstreamName: this.streamSession.streamName,\r\n\t\t\t\t\tportrait: false,\r\n\t\t\t\t\tpanoramic: false,\r\n\t\t\t\t\tcategoryID: this.roomProfile.liveType.categoryID,\r\n\t\t\t\t\tsubCategoryID: this.roomProfile.liveType.subCategoryID\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e: any) => {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tElMessage({\r\n\t\t\t\t\t\tmessage: e,\r\n\t\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\t\toffset: 60\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tlet errmsg = \"\";\r\n\t\t\tif (!this.roomProfile.title) {\r\n\t\t\t\terrmsg += \"房间标题不为空 \";\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\t!this.roomProfile.liveCover ||\r\n\t\t\t\tthis.roomProfile.liveCover.includes(\"base64\")\r\n\t\t\t) {\r\n\t\t\t\terrmsg += \"房间封面无效，请重新上传 \";\r\n\t\t\t}\r\n\t\t\tif (this.obsSync && !OBS.obs) {\r\n\t\t\t\terrmsg += \"OBS未能连接，请刷新OBS状态或确认插件是否安装 \";\r\n\t\t\t}\r\n\t\t\tif (errmsg) {\r\n\t\t\t\tElMessage({\r\n\t\t\t\t\tmessage: \"错误: \" + errmsg,\r\n\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\toffset: 60\r\n\t\t\t\t});\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@import \"@front/styles/variables.scss\";\r\n#roomMgmt {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\t:deep .imgInput {\r\n\t\twidth: 100%;\r\n\t\tpadding-bottom: 40%;\r\n\t\tbox-shadow: $--box-shadow-base;\r\n\t}\r\n\t.btnBase {\r\n\t\tbackground-color: $--color-primary;\r\n\t\tcolor: white;\r\n\t\t&.attach {\r\n\t\t\tborder-top-left-radius: 0px !important;\r\n\t\t\tborder-bottom-left-radius: 0px !important;\r\n\t\t\tbox-shadow: none !important;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from \"vue\";\r\nimport { mapGetters, mapState } from \"vuex\";\r\nimport cloneDeep from \"lodash/cloneDeep\";\r\nimport { ElMessage, ElMessageBox } from \"element-plus\";\r\nimport { room } from \"@front/datas\";\r\nimport { closeStream } from \"@front/mixins/methods\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nimport { sleep, isUrl } from \"@front/util_function/base\";\r\nimport { copy } from \"@front/util_function/clipboard\";\r\nimport OBS from \"@front/util_function/obs\";\r\nimport { getCutStatus, setCutStatus } from \"@front/api/room\";\r\nexport default defineComponent({\r\n\tname: \"roomMgmt\",\r\n\tmixins: [closeStream],\r\n\tdata() {\r\n\t\tconst roomProfile: room.ProfileDetail = cloneDeep(\r\n\t\t\tthis.$store.state.roomProfile\r\n\t\t);\r\n\t\tif (roomProfile.liveType.categoryID === 0) {\r\n\t\t\troomProfile.liveType.categoryID = 1;\r\n\t\t\troomProfile.liveType.subCategoryID = 101;\r\n\t\t}\r\n\t\tconst timer: any = null;\r\n\t\treturn {\r\n\t\t\tOBS,\r\n\t\t\tobsSync: false,\r\n\t\t\tloading: false,\r\n\t\t\tcanCut: false,\r\n\t\t\tcount: 0,\r\n\t\t\ttimer,\r\n\t\t\troomProfile,\r\n\t\t\tdanmakuStream: `${window.location.origin}/obs/danmaku/`,\r\n\t\t\tmagicScreen: `${window.location.origin}/obs/screen`\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters([\"categoryCascade\", \"isStreaming\"]),\r\n\t\t...mapState([\r\n\t\t\t\"streamSession\",\r\n\t\t\t\"streamEncodec\",\r\n\t\t\t\"roomCategorys\",\r\n\t\t\t\"userSession\"\r\n\t\t]),\r\n\t\tchanged(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\tthis.roomProfile.title ===\r\n\t\t\t\t\tthis.$store.state.roomProfile.title &&\r\n\t\t\t\tthis.roomProfile.liveCover ===\r\n\t\t\t\t\tthis.$store.state.roomProfile.liveCover\r\n\t\t\t);\r\n\t\t},\r\n\t\tdanmakuOfficial(): string {\r\n\t\t\treturn `https://live.acfun.cn/room/${this.userSession.userID}?theme=default&showAuthorclubOnly=true&showAvatar=true`;\r\n\t\t},\r\n\t\tcategoryValue: {\r\n\t\t\tget(): Array<number> {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tthis.roomProfile.liveType.categoryID,\r\n\t\t\t\t\tthis.roomProfile.liveType.subCategoryID\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t\tset(e: any): void {\r\n\t\t\t\tconst subCategoryID = e[1];\r\n\t\t\t\tconst category = this.roomCategorys.find(\r\n\t\t\t\t\t(roomCategory: any) => {\r\n\t\t\t\t\t\treturn roomCategory.subCategoryID === subCategoryID;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tif (category) {\r\n\t\t\t\t\tthis.roomProfile.liveType = { ...category };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$store.commit(\"getCategory\");\r\n\t\tthis.$store.commit(\"getStreamSession\"); // get rtmp key when no streaming\r\n\t\tthis.loadCache();\r\n\t\tthis.getCutStatus();\r\n\t\tevent.on(\"openStream\", this.openStream);\r\n\t\tthis.timer = setInterval(() => {\r\n\t\t\tthis.$store.commit(\"getStreamEncodec\");\r\n\t\t}, 3000);\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tthis.saveCache();\r\n\t\tevent.off(\"openStream\", this.openStream);\r\n\t\tevent.emit(\"openStreamEnd\");\r\n\t\tclearInterval(this.timer);\r\n\t},\r\n\tmethods: {\r\n\t\tgetCutStatus() {\r\n\t\t\tgetCutStatus().then(({ canCut }) => {\r\n\t\t\t\tthis.canCut = canCut;\r\n\t\t\t});\r\n\t\t},\r\n\t\tsetCanCut() {\r\n\t\t\tsetCutStatus(this.canCut)\r\n\t\t\t\t.catch((message: any) => {\r\n\t\t\t\t\tElMessage({\r\n\t\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\t\tmessage,\r\n\t\t\t\t\t\tduration: 1500\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.finally(this.getCutStatus);\r\n\t\t},\r\n\t\tcopy,\r\n\t\tsaveCache() {\r\n\t\t\tlocalStorage.setItem(\r\n\t\t\t\t\"imgCache\",\r\n\t\t\t\tJSON.stringify({\r\n\t\t\t\t\ttitle: this.roomProfile.title,\r\n\t\t\t\t\timg: this.roomProfile.liveCover,\r\n\t\t\t\t\tcategory: this.roomProfile.liveType,\r\n\t\t\t\t\tobsSync: this.obsSync\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t},\r\n\t\tloadCache() {\r\n\t\t\tlet cache: any = localStorage.getItem(\"imgCache\");\r\n\t\t\tif (!cache) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tcache = JSON.parse(cache);\r\n\t\t\tthis.roomProfile.title = cache.title;\r\n\t\t\tthis.roomProfile.liveCover = cache.img;\r\n\t\t\tthis.roomProfile.liveType = cache.category || room.category();\r\n\t\t\tthis.obsSync = cache.obsSync;\r\n\t\t},\r\n\t\tasync setRoomProfile() {\r\n\t\t\tawait this.$store.commit(\"setRoomProfile\", {\r\n\t\t\t\tliveID: this.$store.state.roomProfile.liveID,\r\n\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\r\n\t\t\t\ttitle: this.roomProfile.title\r\n\t\t\t});\r\n\t\t\tevent.once(\"roomProfileChanged\", () => {\r\n\t\t\t\tElMessage({\r\n\t\t\t\t\tmessage: \"修改成功\",\r\n\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\ttype: \"success\",\r\n\t\t\t\t\toffset: 60\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tasync openStream() {\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\r\n\t\t\t\t}, 500);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.obsSync) {\r\n\t\t\t\tconst status = await this.OBS.checkStatus();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (status?.streaming) {\r\n\t\t\t\t\t\tawait this.OBS.stopStream();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tawait sleep(2000);\r\n\t\t\t\t\tawait this.OBS.setStreamSettings({\r\n\t\t\t\t\t\tserver: this.streamSession.rtmpServer,\r\n\t\t\t\t\t\tkey: this.streamSession.streamKey\r\n\t\t\t\t\t});\r\n\t\t\t\t\tawait this.OBS.startStream();\r\n\t\t\t\t\tthis.readyToStream();\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\tElMessageBox({\r\n\t\t\t\t\t\ttitle: \"OBS启播失败\",\r\n\t\t\t\t\t\tconfirmButtonText: \"淦哦\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.readyToStream();\r\n\t\t},\r\n\t\tgenerateUrl(str: string) {\r\n\t\t\tif (isUrl(str)) {\r\n\t\t\t\treturn str;\r\n\t\t\t}\r\n\t\t\treturn `${window.location.origin}${str}`;\r\n\t\t},\r\n\t\tasync readyToStream() {\r\n\t\t\tthis.loading = true;\r\n\t\t\tif (!this?.streamEncodec?.resolution) {\r\n\t\t\t\tif (this.count < 60) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.count++;\r\n\t\t\t\t\t\tthis.readyToStream();\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tElMessage({\r\n\t\t\t\t\tmessage: \"推流未成功，请等待10秒/刷新密匙重新配置后重试\",\r\n\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\toffset: 60\r\n\t\t\t\t});\r\n\t\t\t\tthis.count = 0;\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t\tevent.emit(\"openStreamEnd\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.saveCache();\r\n\t\t\tthis.$store\r\n\t\t\t\t.dispatch(\"openStream\", {\r\n\t\t\t\t\ttitle: this.roomProfile.title,\r\n\t\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\r\n\t\t\t\t\tstreamName: this.streamSession.streamName,\r\n\t\t\t\t\tportrait: false,\r\n\t\t\t\t\tpanoramic: false,\r\n\t\t\t\t\tcategoryID: this.roomProfile.liveType.categoryID,\r\n\t\t\t\t\tsubCategoryID: this.roomProfile.liveType.subCategoryID\r\n\t\t\t\t})\r\n\t\t\t\t.catch((e: any) => {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t\tElMessage({\r\n\t\t\t\t\t\tmessage: e,\r\n\t\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\t\toffset: 60\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tlet errmsg = \"\";\r\n\t\t\tif (!this.roomProfile.title) {\r\n\t\t\t\terrmsg += \"房间标题不为空 \";\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\t!this.roomProfile.liveCover ||\r\n\t\t\t\tthis.roomProfile.liveCover.includes(\"base64\")\r\n\t\t\t) {\r\n\t\t\t\terrmsg += \"房间封面无效，请重新上传 \";\r\n\t\t\t}\r\n\t\t\tif (this.obsSync && !OBS.obs) {\r\n\t\t\t\terrmsg += \"OBS未能连接，请刷新OBS状态或确认插件是否安装 \";\r\n\t\t\t}\r\n\t\t\tif (errmsg) {\r\n\t\t\t\tElMessage({\r\n\t\t\t\t\tmessage: \"错误: \" + errmsg,\r\n\t\t\t\t\tduration: 1500,\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\toffset: 60\r\n\t\t\t\t});\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=4617813b&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=4617813b&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-4617813b\"\n\nexport default script"],"sourceRoot":""}