{"version":3,"sources":["webpack:///./src/electron_browser/util_function/formatter.ts","webpack:///./src/electron_browser/views/roomMgmt/index.vue?c67f","webpack:///./src/electron_browser/views/roomMgmt/index.vue","webpack:///./src/electron_browser/views/roomMgmt/index.vue?eb38","webpack:///./src/electron_browser/views/roomMgmt/index.vue?da18"],"names":["unixTimeFormatter","timestamp","zeroPadding","n","length","hour","Math","floor","minute","second","String","thousandFormatter","count","unit","toFixed","hundrenFormatter","class","id","title","roomProfile","liveCover","size","placeholder","flex","span","style","categoryValue","options","categoryCascade","isStreaming","type","setRoomProfile","disabled","changed","model-value","danmakuStream","append","copy","obsSync","OBS","obs","connect","streamSession","rtmpServer","streamKey","$store","commit","streamEncodec","resolution","closeStream","loading","name","mixins","this","state","liveType","categoryID","subCategoryID","window","location","host","magicScreen","computed","e","category","roomCategorys","find","roomCategory","loadCache","on","openStream","saveCache","off","emit","methods","localStorage","setItem","JSON","stringify","img","cache","getItem","parse","liveID","coverFile","generateUrl","once","message","duration","offset","validation","status","checkStatus","streaming","stopStream","setStreamSettings","server","key","startStream","readyToStream","error","console","confirmButtonText","setTimeout","str","dispatch","streamName","portrait","panoramic","catch","finally","errmsg","includes","render","__scopeId"],"mappings":"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","file":"js/chunk-1fecb262.1c9abcfd.js","sourcesContent":["export const unixTimeFormatter = (timestamp: number) => {\n\tconst zeroPadding = (n: string) => {\n\t\tif (n.length < 2) {\n\t\t\treturn `0${n}`;\n\t\t}\n\t\treturn n;\n\t};\n\ttimestamp = timestamp / 1000;\n\tconst hour = Math.floor(timestamp / 3600);\n\tconst minute = Math.floor((timestamp - hour * 3600) / 60);\n\tconst second = Math.floor(timestamp % 60);\n\treturn `${zeroPadding(String(hour))}:${zeroPadding(\n\t\tString(minute)\n\t)}:${zeroPadding(String(second))}`;\n};\nexport const thousandFormatter = (count: number, unit = \"万\"): string => {\n\tif (count < 10000) {\n\t\treturn String(count);\n\t}\n\n\treturn `${(count / 10000).toFixed(1)}${unit}`;\n};\n\nexport const hundrenFormatter = (count: number): string => {\n\tif (count > 10000) {\n\t\treturn thousandFormatter(count, \"W\");\n\t}\n\tif (count > 1000) {\n\t\treturn `${(count / 1000).toFixed(1)}k`;\n\t}\n\treturn String(count);\n};\n","export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=27091f48&scoped=true&lang=scss\"","<template>\n\t<content-frame id=\"roomMgmt\" v-loading=\"loading\">\n\t\t<row-frame title=\"封面选择\">\n\t\t\t<row-span>\n\t\t\t\t<img-input-clip v-model=\"roomProfile.liveCover\" />\n\t\t\t\t<div class=\"hint\">（仅支持jpg、png格式，推荐比例16:10）</div>\n\t\t\t</row-span>\n\t\t</row-frame>\n\t\t<row-frame title=\"房间标题\">\n\t\t\t<row-span>\n\t\t\t\t<el-input size=\"mini\" placeholder=\"请输入房间名称\" v-model=\"roomProfile.title\" />\n\t\t\t</row-span>\n\t\t</row-frame>\n\t\t<row-frame :flex=\"true\">\n\t\t\t<row-span :span=\"8\">\n\t\t\t\t<row-frame title=\"直播分区\" :flex=\"true\" style=\"width:100%;margin-bottom:0px\">\n\t\t\t\t\t<el-cascader size=\"mini\" style=\"width:100%\" placeholder=\"请选择分区\" v-model=\"categoryValue\" :options=\"categoryCascade\" />\n\t\t\t\t</row-frame>\n\t\t\t</row-span>\n\t\t\t<!-- <row-span :span=\"4\">\n\t\t\t\t<row-frame title=\"子分区\" :flex=\"true\" style=\"width:100%;margin-bottom:0px\">\n\t\t\t\t</row-frame>\n\t\t\t</row-span> -->\n\t\t\t<row-span :span=\"4\" v-if=\"isStreaming\">\n\t\t\t\t<row-frame title=\" \" style=\"width:100%;margin-bottom:0px;text-align:right\">\n\t\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase\" @click=\"setRoomProfile\" :disabled=\"changed\">修改标题封面\n\t\t\t\t\t</el-button>\n\t\t\t\t</row-frame>\n\t\t\t</row-span>\n\t\t</row-frame>\n\t\t<!-- <row-frame title=\"开播选项\" :flex=\"true\">\n\t\t\t<row-span :span=\"6\" style=\"margin-bottom:8px\">\n\t\t\t\t<el-switch disabled active-text=\"OBS同步推流\" />\n\t\t\t</row-span>\n\t\t\t<row-span :span=\"6\" style=\"margin-bottom:8px\">\n\t\t\t\t<el-switch disabled active-text=\"OBS同步录像\" />\n\t\t\t</row-span>\n\t\t\t<row-span :span=\"6\" style=\"margin-bottom:8px\">\n\t\t\t\t<el-switch disabled active-text=\"群发通知\" />\n\t\t\t</row-span>\n\t\t\t<row-span :span=\"6\" style=\"margin-bottom:8px\">\n\t\t\t\t<el-switch disabled active-text=\"鸡鸡人\" />\n\t\t\t</row-span>\n\n\t\t</row-frame> -->\n\t\t<row-frame title=\"弹幕流链接\" :flex=\"true\">\n\t\t\t<row-span :span=\"12\">\n\t\t\t\t<el-input size=\"mini\" :model-value=\"danmakuStream\">\n\t\t\t\t\t<template #append>\n\t\t\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase attach\" @click=\"copy(danmakuStream)\">复制</el-button>\n\t\t\t\t\t</template>\n\t\t\t\t</el-input>\n\t\t\t\t<div class=\"hint\">（将上访链接黏贴到推流软件内置浏览器中）</div>\n\t\t\t</row-span>\n\t\t</row-frame>\n\t\t<!-- <row-frame title=\"画屏链接(未完成，无需理会)\">\n\t\t\t<div style=\"width:100%;display:flex\" :flex=\"true\">\n\t\t\t\t<row-span :span=\"12\">\n\t\t\t\t\t<el-input size=\"mini\" :model-value=\"magicScreen\">\n\t\t\t\t\t\t<template #append>\n\t\t\t\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase attach\" @click=\"copy(magicScreen)\">复制</el-button>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</el-input>\n\t\t\t\t</row-span>\n\t\t\t</div>\n\t\t\t<div class=\"hint\">（请复制上方链接，粘贴到推流软件内置浏览器里。）</div>\n\t\t</row-frame> -->\n\t\t<row-frame title=\"OBS同步推流\" :flex=\"true\">\n\t\t\t<row-span :span=\"4\">\n\t\t\t\t<el-checkbox v-model=\"obsSync\">启用</el-checkbox>\n\t\t\t</row-span>\n\t\t\t<row-span v-if=\"obsSync\" :class=\"OBS.obs?'online':'offline'\" :span=\"4\">\n\t\t\t\t{{OBS.obs?\"OBS已连接\":\"OBS未连接\"}}\n\t\t\t</row-span>\n\t\t\t<row-span v-if=\"obsSync\" :span=\"3\">\n\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase\" @click=\"OBS.connect()\">连接OBS\n\t\t\t\t</el-button>\n\t\t\t</row-span>\n\t\t\t<div v-if=\"obsSync\" class=\"hint\">（如上方显示OBS未连接，请根据文件夹中的说明检查是否正确配置）</div>\n\t\t\t<div v-else class=\"hint\">（如需手动推流，请将下方直播地址和直播码配置到推流软件中，待下方推流状态成功后开启直播，acfun直播助手开播后工具箱会自动切换到直播状态）</div>\n\t\t</row-frame>\n\t\t<row-frame v-if=\"!obsSync\" title=\"RTMP服务器(Server)\" :flex=\"true\">\n\t\t\t<row-span :span=\"12\">\n\t\t\t\t<el-input size=\"mini\" :model-value=\"streamSession.rtmpServer\">\n\t\t\t\t\t<template #append>\n\t\t\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase attach\" @click=\"copy(streamSession.rtmpServer)\">复制\n\t\t\t\t\t\t</el-button>\n\t\t\t\t\t</template>\n\t\t\t\t</el-input>\n\t\t\t</row-span>\n\t\t</row-frame>\n\t\t<row-frame v-if=\"!obsSync\" title=\"直播码/串流密钥(Stream Key)\" :flex=\"true\">\n\t\t\t<row-span :span=\"9.5\">\n\t\t\t\t<el-input size=\"mini\" :model-value=\"streamSession.streamKey\">\n\t\t\t\t\t<template #append>\n\t\t\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase attach\" @click=\"copy(streamSession.streamKey)\">复制\n\t\t\t\t\t\t</el-button>\n\t\t\t\t\t</template>\n\t\t\t\t</el-input>\n\t\t\t</row-span>\n\t\t\t<row-span :span=\"2\">\n\t\t\t\t<el-button type=\"primary\" size=\"mini\" @click=\"$store.commit('getStreamSession')\">刷新</el-button>\n\t\t\t</row-span>\n\t\t\t<div class=\"hint\">（考虑到用户隐私，直播码每次开播都会默认刷新）</div>\n\t\t</row-frame>\n\t\t<row-frame v-if=\"!obsSync\" title=\"推流状态\" :flex=\"true\">\n\t\t\t<row-span :class=\"streamEncodec.resolution?'online':'offline'\" :span=\"4\">\n\t\t\t\t{{streamEncodec.resolution?\"推流成功\":\"推流等待中\"}}\n\t\t\t</row-span>\n\t\t\t<row-span :span=\"2\">\n\t\t\t\t<el-button type=\"primary\" size=\"mini\" @click=\"$store.commit('getStreamEncodec')\">刷新</el-button>\n\t\t\t</row-span>\n\t\t</row-frame>\n\t\t<row-frame title=\"下播\" v-if=\"isStreaming\" :flex=\"true\">\n\t\t\t<row-span :span=\"4\">\n\t\t\t\t<el-button type=\"primary\" size=\"mini\" class=\"btnBase\" @click=\"closeStream\">下播\n\t\t\t\t</el-button>\n\t\t\t</row-span>\n\t\t</row-frame>\n\t</content-frame>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from \"vue\";\nimport { mapGetters, mapState } from \"vuex\";\nimport cloneDeep from \"lodash/cloneDeep\";\nimport { ElMessage, ElMessageBox } from \"element-plus\";\nimport { room } from \"@front/datas\";\nimport { closeStream } from \"@front/mixins/methods\";\nimport { event } from \"@front/util_function/eventBus\";\nimport { sleep, isUrl } from \"@front/util_function/base\";\nimport { copy } from \"@front/util_function/clipboard\";\nimport OBS from \"@front/util_function/obs\";\nexport default defineComponent({\n\tname: \"roomMgmt\",\n\tmixins: [closeStream],\n\tdata() {\n\t\tconst roomProfile: room.ProfileDetail = cloneDeep(\n\t\t\tthis.$store.state.roomProfile\n\t\t);\n\t\tif (roomProfile.liveType.categoryID === 0) {\n\t\t\troomProfile.liveType.categoryID = 1;\n\t\t\troomProfile.liveType.subCategoryID = 101;\n\t\t}\n\t\treturn {\n\t\t\tOBS,\n\t\t\tobsSync: false,\n\t\t\tloading: false,\n\t\t\troomProfile,\n\t\t\tdanmakuStream: `http://${window.location.host}/obs/danmaku/`,\n\t\t\tmagicScreen: `http://${window.location.host}/obs/screen`\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters([\"categoryCascade\", \"isStreaming\"]),\n\t\t...mapState([\"streamSession\", \"streamEncodec\", \"roomCategorys\"]),\n\t\tchanged(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.roomProfile.title ===\n\t\t\t\t\tthis.$store.state.roomProfile.title &&\n\t\t\t\tthis.roomProfile.liveCover ===\n\t\t\t\t\tthis.$store.state.roomProfile.liveCover\n\t\t\t);\n\t\t},\n\t\tcategoryValue: {\n\t\t\tget(): Array<number> {\n\t\t\t\treturn [\n\t\t\t\t\tthis.roomProfile.liveType.categoryID,\n\t\t\t\t\tthis.roomProfile.liveType.subCategoryID\n\t\t\t\t];\n\t\t\t},\n\t\t\tset(e: any): void {\n\t\t\t\tconst subCategoryID = e[1];\n\t\t\t\tconst category = this.roomCategorys.find(\n\t\t\t\t\t(roomCategory: any) => {\n\t\t\t\t\t\treturn roomCategory.subCategoryID === subCategoryID;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tif (category) {\n\t\t\t\t\tthis.roomProfile.liveType = { ...category };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$store.commit(\"getCategory\");\n\t\tthis.$store.commit(\"getStreamSession\"); // get rtmp key when no streaming\n\t\tthis.loadCache();\n\t\tevent.on(\"openStream\", this.openStream);\n\t},\n\tbeforeUnmount() {\n\t\tthis.saveCache();\n\t\tevent.off(\"openStream\", this.openStream);\n\t\tevent.emit(\"openStreamEnd\");\n\t},\n\tmethods: {\n\t\tcopy,\n\t\tsaveCache() {\n\t\t\tlocalStorage.setItem(\n\t\t\t\t\"imgCache\",\n\t\t\t\tJSON.stringify({\n\t\t\t\t\ttitle: this.roomProfile.title,\n\t\t\t\t\timg: this.roomProfile.liveCover,\n\t\t\t\t\tcategory: this.roomProfile.liveType,\n\t\t\t\t\tobsSync: this.obsSync\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tloadCache() {\n\t\t\tlet cache: any = localStorage.getItem(\"imgCache\");\n\t\t\tif (!cache) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcache = JSON.parse(cache);\n\t\t\tthis.roomProfile.title = cache.title;\n\t\t\tthis.roomProfile.liveCover = cache.img;\n\t\t\tthis.roomProfile.liveType = cache.category || room.category();\n\t\t\tthis.obsSync = cache.obsSync;\n\t\t},\n\t\tasync setRoomProfile() {\n\t\t\tawait this.$store.commit(\"setRoomProfile\", {\n\t\t\t\tliveID: this.$store.state.roomProfile.liveID,\n\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\n\t\t\t\ttitle: this.roomProfile.title\n\t\t\t});\n\t\t\tevent.once(\"roomProfileChanged\", () => {\n\t\t\t\tElMessage({\n\t\t\t\t\tmessage: \"修改成功\",\n\t\t\t\t\tduration: 1500,\n\t\t\t\t\ttype: \"success\",\n\t\t\t\t\toffset: 60\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tasync openStream() {\n\t\t\tif (!this.validation()) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\n\t\t\t\t}, 500);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.obsSync) {\n\t\t\t\tconst status = await this.OBS.checkStatus();\n\t\t\t\ttry {\n\t\t\t\t\tif (status?.streaming) {\n\t\t\t\t\t\tawait this.OBS.stopStream();\n\t\t\t\t\t}\n\t\t\t\t\tawait sleep(2000);\n\t\t\t\t\tawait this.OBS.setStreamSettings({\n\t\t\t\t\t\tserver: this.streamSession.rtmpServer,\n\t\t\t\t\t\tkey: this.streamSession.streamKey\n\t\t\t\t\t});\n\t\t\t\t\tawait this.OBS.startStream();\n\t\t\t\t\tthis.readyToStream();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t\tElMessageBox({\n\t\t\t\t\t\ttitle: \"OBS启播失败\",\n\t\t\t\t\t\tconfirmButtonText: \"淦哦\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.readyToStream();\n\t\t\tElMessage({\n\t\t\t\tmessage: \"推流未成功，请等待10秒/刷新密匙重新配置后重试\",\n\t\t\t\tduration: 1500,\n\t\t\t\ttype: \"error\",\n\t\t\t\toffset: 60\n\t\t\t});\n\t\t},\n\t\tgenerateUrl(str: string) {\n\t\t\tif (isUrl(str)) {\n\t\t\t\treturn str;\n\t\t\t}\n\t\t\treturn `http://${window.location.host}${str}`;\n\t\t},\n\t\tasync readyToStream() {\n\t\t\tthis.loading = true;\n\t\t\tif (!this?.streamEncodec?.resolution) {\n\t\t\t\tthis.$store.commit(\"getStreamEncodec\");\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.readyToStream();\n\t\t\t\t}, 1000);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.saveCache();\n\t\t\tthis.$store\n\t\t\t\t.dispatch(\"openStream\", {\n\t\t\t\t\ttitle: this.roomProfile.title,\n\t\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\n\t\t\t\t\tstreamName: this.streamSession.streamName,\n\t\t\t\t\tportrait: false,\n\t\t\t\t\tpanoramic: false,\n\t\t\t\t\tcategoryID: this.roomProfile.liveType.categoryID,\n\t\t\t\t\tsubCategoryID: this.roomProfile.liveType.subCategoryID\n\t\t\t\t})\n\t\t\t\t.catch((e: any) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tElMessage({\n\t\t\t\t\t\tmessage: e,\n\t\t\t\t\t\tduration: 1500,\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\toffset: 60\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\n\t\t\t\t});\n\t\t},\n\t\tvalidation() {\n\t\t\tlet errmsg = \"\";\n\t\t\tif (!this.roomProfile.title) {\n\t\t\t\terrmsg += \"房间标题不为空 \";\n\t\t\t}\n\t\t\tif (\n\t\t\t\t!this.roomProfile.liveCover ||\n\t\t\t\tthis.roomProfile.liveCover.includes(\"base64\")\n\t\t\t) {\n\t\t\t\terrmsg += \"房间封面无效，请重新上传 \";\n\t\t\t}\n\t\t\tif (this.obsSync && !OBS.obs) {\n\t\t\t\terrmsg += \"OBS未能连接，请刷新OBS状态或确认插件是否安装 \";\n\t\t\t}\n\t\t\tif (errmsg) {\n\t\t\t\tElMessage({\n\t\t\t\t\tmessage: \"错误: \" + errmsg,\n\t\t\t\t\tduration: 1500,\n\t\t\t\t\ttype: \"error\",\n\t\t\t\t\toffset: 60\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t}\n});\n</script>\n\n<style scoped lang='scss'>\n@import \"@front/styles/variables.scss\";\n#roomMgmt {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\t:deep .imgInput {\n\t\twidth: 100%;\n\t\tpadding-bottom: 40%;\n\t\tbox-shadow: $--box-shadow-base;\n\t}\n\t.btnBase {\n\t\tbackground-color: $--color-primary;\n\t\tcolor: white;\n\t\t&.attach {\n\t\t\tborder-top-left-radius: 0px !important;\n\t\t\tborder-bottom-left-radius: 0px !important;\n\t\t\tbox-shadow: none !important;\n\t\t}\n\t}\n}\n</style>\n","\nimport { defineComponent } from \"vue\";\nimport { mapGetters, mapState } from \"vuex\";\nimport cloneDeep from \"lodash/cloneDeep\";\nimport { ElMessage, ElMessageBox } from \"element-plus\";\nimport { room } from \"@front/datas\";\nimport { closeStream } from \"@front/mixins/methods\";\nimport { event } from \"@front/util_function/eventBus\";\nimport { sleep, isUrl } from \"@front/util_function/base\";\nimport { copy } from \"@front/util_function/clipboard\";\nimport OBS from \"@front/util_function/obs\";\nexport default defineComponent({\n\tname: \"roomMgmt\",\n\tmixins: [closeStream],\n\tdata() {\n\t\tconst roomProfile: room.ProfileDetail = cloneDeep(\n\t\t\tthis.$store.state.roomProfile\n\t\t);\n\t\tif (roomProfile.liveType.categoryID === 0) {\n\t\t\troomProfile.liveType.categoryID = 1;\n\t\t\troomProfile.liveType.subCategoryID = 101;\n\t\t}\n\t\treturn {\n\t\t\tOBS,\n\t\t\tobsSync: false,\n\t\t\tloading: false,\n\t\t\troomProfile,\n\t\t\tdanmakuStream: `http://${window.location.host}/obs/danmaku/`,\n\t\t\tmagicScreen: `http://${window.location.host}/obs/screen`\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters([\"categoryCascade\", \"isStreaming\"]),\n\t\t...mapState([\"streamSession\", \"streamEncodec\", \"roomCategorys\"]),\n\t\tchanged(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.roomProfile.title ===\n\t\t\t\t\tthis.$store.state.roomProfile.title &&\n\t\t\t\tthis.roomProfile.liveCover ===\n\t\t\t\t\tthis.$store.state.roomProfile.liveCover\n\t\t\t);\n\t\t},\n\t\tcategoryValue: {\n\t\t\tget(): Array<number> {\n\t\t\t\treturn [\n\t\t\t\t\tthis.roomProfile.liveType.categoryID,\n\t\t\t\t\tthis.roomProfile.liveType.subCategoryID\n\t\t\t\t];\n\t\t\t},\n\t\t\tset(e: any): void {\n\t\t\t\tconst subCategoryID = e[1];\n\t\t\t\tconst category = this.roomCategorys.find(\n\t\t\t\t\t(roomCategory: any) => {\n\t\t\t\t\t\treturn roomCategory.subCategoryID === subCategoryID;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tif (category) {\n\t\t\t\t\tthis.roomProfile.liveType = { ...category };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tmounted() {\n\t\tthis.$store.commit(\"getCategory\");\n\t\tthis.$store.commit(\"getStreamSession\"); // get rtmp key when no streaming\n\t\tthis.loadCache();\n\t\tevent.on(\"openStream\", this.openStream);\n\t},\n\tbeforeUnmount() {\n\t\tthis.saveCache();\n\t\tevent.off(\"openStream\", this.openStream);\n\t\tevent.emit(\"openStreamEnd\");\n\t},\n\tmethods: {\n\t\tcopy,\n\t\tsaveCache() {\n\t\t\tlocalStorage.setItem(\n\t\t\t\t\"imgCache\",\n\t\t\t\tJSON.stringify({\n\t\t\t\t\ttitle: this.roomProfile.title,\n\t\t\t\t\timg: this.roomProfile.liveCover,\n\t\t\t\t\tcategory: this.roomProfile.liveType,\n\t\t\t\t\tobsSync: this.obsSync\n\t\t\t\t})\n\t\t\t);\n\t\t},\n\t\tloadCache() {\n\t\t\tlet cache: any = localStorage.getItem(\"imgCache\");\n\t\t\tif (!cache) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcache = JSON.parse(cache);\n\t\t\tthis.roomProfile.title = cache.title;\n\t\t\tthis.roomProfile.liveCover = cache.img;\n\t\t\tthis.roomProfile.liveType = cache.category || room.category();\n\t\t\tthis.obsSync = cache.obsSync;\n\t\t},\n\t\tasync setRoomProfile() {\n\t\t\tawait this.$store.commit(\"setRoomProfile\", {\n\t\t\t\tliveID: this.$store.state.roomProfile.liveID,\n\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\n\t\t\t\ttitle: this.roomProfile.title\n\t\t\t});\n\t\t\tevent.once(\"roomProfileChanged\", () => {\n\t\t\t\tElMessage({\n\t\t\t\t\tmessage: \"修改成功\",\n\t\t\t\t\tduration: 1500,\n\t\t\t\t\ttype: \"success\",\n\t\t\t\t\toffset: 60\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tasync openStream() {\n\t\t\tif (!this.validation()) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\n\t\t\t\t}, 500);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.obsSync) {\n\t\t\t\tconst status = await this.OBS.checkStatus();\n\t\t\t\ttry {\n\t\t\t\t\tif (status?.streaming) {\n\t\t\t\t\t\tawait this.OBS.stopStream();\n\t\t\t\t\t}\n\t\t\t\t\tawait sleep(2000);\n\t\t\t\t\tawait this.OBS.setStreamSettings({\n\t\t\t\t\t\tserver: this.streamSession.rtmpServer,\n\t\t\t\t\t\tkey: this.streamSession.streamKey\n\t\t\t\t\t});\n\t\t\t\t\tawait this.OBS.startStream();\n\t\t\t\t\tthis.readyToStream();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t\tElMessageBox({\n\t\t\t\t\t\ttitle: \"OBS启播失败\",\n\t\t\t\t\t\tconfirmButtonText: \"淦哦\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.readyToStream();\n\t\t\tElMessage({\n\t\t\t\tmessage: \"推流未成功，请等待10秒/刷新密匙重新配置后重试\",\n\t\t\t\tduration: 1500,\n\t\t\t\ttype: \"error\",\n\t\t\t\toffset: 60\n\t\t\t});\n\t\t},\n\t\tgenerateUrl(str: string) {\n\t\t\tif (isUrl(str)) {\n\t\t\t\treturn str;\n\t\t\t}\n\t\t\treturn `http://${window.location.host}${str}`;\n\t\t},\n\t\tasync readyToStream() {\n\t\t\tthis.loading = true;\n\t\t\tif (!this?.streamEncodec?.resolution) {\n\t\t\t\tthis.$store.commit(\"getStreamEncodec\");\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.readyToStream();\n\t\t\t\t}, 1000);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.saveCache();\n\t\t\tthis.$store\n\t\t\t\t.dispatch(\"openStream\", {\n\t\t\t\t\ttitle: this.roomProfile.title,\n\t\t\t\t\tcoverFile: this.generateUrl(this.roomProfile.liveCover),\n\t\t\t\t\tstreamName: this.streamSession.streamName,\n\t\t\t\t\tportrait: false,\n\t\t\t\t\tpanoramic: false,\n\t\t\t\t\tcategoryID: this.roomProfile.liveType.categoryID,\n\t\t\t\t\tsubCategoryID: this.roomProfile.liveType.subCategoryID\n\t\t\t\t})\n\t\t\t\t.catch((e: any) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tElMessage({\n\t\t\t\t\t\tmessage: e,\n\t\t\t\t\t\tduration: 1500,\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\toffset: 60\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t\tevent.emit(\"openStreamEnd\");\n\t\t\t\t});\n\t\t},\n\t\tvalidation() {\n\t\t\tlet errmsg = \"\";\n\t\t\tif (!this.roomProfile.title) {\n\t\t\t\terrmsg += \"房间标题不为空 \";\n\t\t\t}\n\t\t\tif (\n\t\t\t\t!this.roomProfile.liveCover ||\n\t\t\t\tthis.roomProfile.liveCover.includes(\"base64\")\n\t\t\t) {\n\t\t\t\terrmsg += \"房间封面无效，请重新上传 \";\n\t\t\t}\n\t\t\tif (this.obsSync && !OBS.obs) {\n\t\t\t\terrmsg += \"OBS未能连接，请刷新OBS状态或确认插件是否安装 \";\n\t\t\t}\n\t\t\tif (errmsg) {\n\t\t\t\tElMessage({\n\t\t\t\t\tmessage: \"错误: \" + errmsg,\n\t\t\t\t\tduration: 1500,\n\t\t\t\t\ttype: \"error\",\n\t\t\t\t\toffset: 60\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t}\n});\n","import { render } from \"./index.vue?vue&type=template&id=27091f48&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=27091f48&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-27091f48\"\n\nexport default script"],"sourceRoot":""}