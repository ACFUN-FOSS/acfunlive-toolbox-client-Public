{"version":3,"sources":["webpack:///./src/electron_browser/views/login/index.vue?bf43","webpack:///./src/electron_browser/views/login/index.vue","webpack:///./src/electron_browser/util_function/cookies.ts","webpack:///./src/electron_browser/components/system/topbars/base.vue","webpack:///./src/electron_browser/components/system/topbars/base.vue?22ff","webpack:///./src/electron_browser/components/system/topbars/base.vue?43e2","webpack:///./src/electron_browser/views/login/index.vue?8faa","webpack:///./src/electron_browser/views/login/index.vue?aade","webpack:///./src/electron_browser/components/system/topbars/base.vue?0793"],"names":["id","class","src","name","mode","welcome","loginTexts","welcomeLogo","welcomeLogoKey","welcomeText","userData","account","disabled","logining","login","placeholder","type","password","disclaimerCheck","disclaimerDialog","keepLogined","loginDisabled","key","loginText","custom-class","title","footer","size","disclaimer","common","version","Cookies","value","ttl","localStorage","setItem","JSON","stringify","expiry","Date","getTime","parse","getItem","removeItem","error","minimize","close","HandlerMoving","components","methods","render","__scopeId","topbarBase","checkTimer","serveOnline","loginFailedText","computed","this","getCookie","autoLogin","then","res","$store","state","danmakuProfile","general","streamToolEnable","streamToolPath","checkOnline","clearInterval","setTimeout","sessionStorage","validation","tokenInfo","userSession","console","log","setCookie","dispatch","$router","replace","get","serviceToken","expiry2","set"],"mappings":"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","file":"js/chunk-5542868b.a6f716dd.js","sourcesContent":["export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=78ba6ecd&lang=scss&scoped=true\"","<template>\r\n\t<div id=\"login\">\r\n\t\t<topbar-base class=\"topbar\" />\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<div class=\"panel\" v-if=\"!welcome\">\r\n\t\t\t\t<hero-base class=\"hero\" />\r\n\t\t\t\t<div class=\"form\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-input\r\n\t\t\t\t\t\t\tv-model=\"userData.account\"\r\n\t\t\t\t\t\t\t:disabled=\"logining\"\r\n\t\t\t\t\t\t\t@keypress.enter=\"login()\"\r\n\t\t\t\t\t\t\tplaceholder=\"A站账号手机号/邮箱\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-input\r\n\t\t\t\t\t\t\ttype=\"password\"\r\n\t\t\t\t\t\t\tv-model=\"userData.password\"\r\n\t\t\t\t\t\t\t:disabled=\"logining\"\r\n\t\t\t\t\t\t\t@keypress.enter=\"login()\"\r\n\t\t\t\t\t\t\tplaceholder=\"A站密码\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row sep\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<el-checkbox\r\n\t\t\t\t\t\t\t\tclass=\"logCheck\"\r\n\t\t\t\t\t\t\t\tv-model=\"userData.disclaimerCheck\"\r\n\t\t\t\t\t\t\t\t:disabled=\"logining\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t同意 ><el-button\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tclass=\"buttonText\"\r\n\t\t\t\t\t\t\t\t@click=\"disclaimerDialog = true\"\r\n\t\t\t\t\t\t\t\t:disabled=\"logining\"\r\n\t\t\t\t\t\t\t\t>免责声明\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<el-checkbox\r\n\t\t\t\t\t\t\t\tclass=\"logCheck\"\r\n\t\t\t\t\t\t\t\tv-model=\"userData.keepLogined\"\r\n\t\t\t\t\t\t\t\t:disabled=\"logining\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t保持登录\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\t:disabled=\"loginDisabled\"\r\n\t\t\t\t\t\t\tclass=\"logBtn\"\r\n\t\t\t\t\t\t\t@click=\"login(true)\"\r\n\t\t\t\t\t\t\t>登陆\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row logText\">\r\n\t\t\t\t\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t\t\t\t\t<div :key=\"loginText\">{{ loginText }}</div>\r\n\t\t\t\t\t\t</transition>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"welcome\" v-else>\r\n\t\t\t\t<img\r\n\t\t\t\t\tclass=\"welcomeLogo\"\r\n\t\t\t\t\t:src=\"`${loginTexts.welcomeLogo}?a=${welcomeLogoKey}`\"\r\n\t\t\t\t/>\r\n\t\t\t\t<div class=\"welcomeText\">{{ loginTexts.welcomeText }}</div>\r\n\t\t\t</div>\r\n\t\t</transition>\r\n\t\t<footer-base class=\"foter right\" />\r\n\t\t<el-dialog\r\n\t\t\tcustom-class=\"dialogBase\"\r\n\t\t\ttitle=\"免责声明\"\r\n\t\t\tv-model=\"disclaimerDialog\"\r\n\t\t>\r\n\t\t\t<div>{{ loginTexts.disclaimer }}</div>\r\n\t\t\t<template #footer>\r\n\t\t\t\t<el-button\r\n\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\tsize=\"mini\"\r\n\t\t\t\t\t@click=\"\r\n\t\t\t\t\t\tuserData.disclaimerCheck = true;\r\n\t\t\t\t\t\tdisclaimerDialog = false;\r\n\t\t\t\t\t\"\r\n\t\t\t\t\t>我同意</el-button\r\n\t\t\t\t>\r\n\t\t\t</template>\r\n\t\t</el-dialog>\r\n\t\t<img class=\"acgirl\" src=\"/imgs/common/welcome.png\" />\r\n\t\t<div class=\"foter left\">软件版本号：{{ common.version }}</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport Cookies from \"@front/util_function/cookies\";\r\nimport topbarBase from \"@front/components/system/topbars/base.vue\";\r\nimport { loadConfig, launch } from \"@front/util_function/system\";\r\nimport { assign } from \"@front/util_function/base\";\r\nimport { login, loginSession } from \"@front/api/user\";\r\nimport { getManagerList } from \"@front/api/room\";\r\nimport { isOnline } from \"@front/api/utils/websocket\";\r\nimport { login as loginTexts, common } from \"@front/texts\";\r\n\r\nexport default defineComponent({\r\n\tname: \"login\",\r\n\tcomponents: {\r\n\t\ttopbarBase\r\n\t},\r\n\tdata() {\r\n\t\tconst checkTimer: any = null;\r\n\t\treturn {\r\n\t\t\tuserData: {\r\n\t\t\t\taccount: \"\",\r\n\t\t\t\tpassword: \"\",\r\n\t\t\t\tkeepLogined: false,\r\n\t\t\t\tdisclaimerCheck: false\r\n\t\t\t},\r\n\t\t\tcommon: common(),\r\n\t\t\tdisclaimerDialog: false,\r\n\t\t\tlogining: false,\r\n\t\t\tserveOnline: false,\r\n\t\t\tcheckTimer,\r\n\t\t\tloginFailedText: \"\",\r\n\t\t\twelcome: false,\r\n\t\t\twelcomeLogoKey: \"111\"\r\n\t\t} as Record<string, any>;\r\n\t},\r\n\tcomputed: {\r\n\t\tloginTexts,\r\n\t\tloginDisabled(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck ||\r\n\t\t\t\tthis.logining\r\n\t\t\t);\r\n\t\t},\r\n\t\tloginText(): string {\r\n\t\t\tif (this.logining) {\r\n\t\t\t\treturn \"登陆中...\";\r\n\t\t\t}\r\n\t\t\tif (this.loginFailedText) {\r\n\t\t\t\treturn `登陆失败： ${this.loginFailedText}`;\r\n\t\t\t}\r\n\t\t\tif (this.serveOnline) {\r\n\t\t\t\treturn \"服务端已连接\";\r\n\t\t\t}\r\n\t\t\treturn \"服务端离线,请尝试关闭工具箱并右键以管理员权限打开\";\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.getCookie();\r\n\t\tthis.autoLogin();\r\n\t\tloadConfig().then((res: any) => {\r\n\t\t\tif (res) {\r\n\t\t\t\tassign(this.$store.state.danmakuProfile, res);\r\n\t\t\t}\r\n\t\t\tif (res?.general?.streamToolEnable) {\r\n\t\t\t\tlaunch(res?.general?.streamToolPath);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.checkOnline();\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearInterval(this.checkTimer);\r\n\t},\r\n\tmethods: {\r\n\t\tcheckOnline() {\r\n\t\t\tisOnline().then(res => (this.serveOnline = res));\r\n\t\t\tthis.checkTimer = setTimeout(this.checkOnline, 5000);\r\n\t\t},\r\n\t\tautoLogin(): void {\r\n\t\t\tif (\r\n\t\t\t\tthis.getCookie() &&\r\n\t\t\t\tthis.userData.keepLogined &&\r\n\t\t\t\tsessionStorage.getItem(\"firstTime\") !== \"false\"\r\n\t\t\t) {\r\n\t\t\t\tthis.login();\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync login() {\r\n\t\t\tthis.logining = true;\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\tthis.logining = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet tokenInfo: any = this.$store.state.userSession;\r\n\t\t\tloginSession(tokenInfo);\r\n\t\t\ttry {\r\n\t\t\t\tawait getManagerList();\r\n\t\t\t} catch (error) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\ttokenInfo = await login(this.userData);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t// TODO: Confirm the type of error, loginFailedText.\r\n\t\t\t\t\tthis.loginFailedText = error;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userData = this.userData;\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\tsessionStorage.setItem(\"logined\", \"true\");\r\n\t\t\tsessionStorage.setItem(\"firstTime\", \"false\");\r\n\t\t\tif (this.userData.keepLogined) {\r\n\t\t\t\tthis.setCookie(tokenInfo);\r\n\t\t\t}\r\n\t\t\tthis.$store.dispatch(\"login\");\r\n\t\t\tthis.$router.replace(\"dashboard\");\r\n\t\t},\r\n\t\tgetCookie() {\r\n\t\t\tconst userData = Cookies.get(\"userData\");\r\n\t\t\tconst tokenInfo = Cookies.get(\"tokenInfo\");\r\n\t\t\tif (userData) {\r\n\t\t\t\tthis.userData = userData;\r\n\t\t\t}\r\n\t\t\tif (!tokenInfo?.serviceToken) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tsetCookie(tokenInfo: any) {\r\n\t\t\tconst expiry = 2 * 60 * 60 * 24 * 1000;\r\n\t\t\tconst expiry2 = 60 * 60 * 60 * 24 * 1000;\r\n\t\t\tCookies.set(\"userData\", this.userData, expiry2);\r\n\t\t\tCookies.set(\"tokenInfo\", tokenInfo, expiry);\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tif (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@front/styles/variables.scss\";\r\n#login {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tfont-size: $--font-size-base;\r\n\tcolor: rgba($color: white, $alpha: 0.9);\r\n\tbackground-color: $--color-primary;\r\n\tbox-shadow: $--box-shadow-dark;\r\n\tborder-radius: $--border-radius-small;\r\n\t.topbar {\r\n\t\tposition: absolute;\r\n\t\ttop: 0px;\r\n\t}\r\n\t.welcome {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%) translateY(-50%);\r\n\t\tuser-select: none;\r\n\t\ttext-align: center;\r\n\t\t.welcomeLogo {\r\n\t\t\twidth: 200px;\r\n\t\t\tmargin-top: -200px;\r\n\t\t\tpointer-events: none;\r\n\t\t}\r\n\t\t.welcomeText {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 24px 0px;\r\n\t\t\tfont-size: $--font-size-extra-large;\r\n\t\t}\r\n\t}\r\n\t.panel {\r\n\t\tposition: absolute;\r\n\t\ttop: 215px;\r\n\t\tleft: 120px;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: flex-start;\r\n\t\tz-index: 100;\r\n\t\t.hero {\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 425px;\r\n\t\t\ttop: 121px;\r\n\t\t\twidth: calc(100vw - 645px);\r\n\t\t}\r\n\t\t.form {\r\n\t\t\tpadding: 24px 0px;\r\n\t\t\theight: 300px;\r\n\t\t\twidth: 300px;\r\n\t\t\t.row {\r\n\t\t\t\tpadding: 6px 0px;\r\n\t\t\t\t.logBtn {\r\n\t\t\t\t\twidth: 300px;\r\n\t\t\t\t\theight: 42px;\r\n\t\t\t\t\tbackground-color: $--color-primary-light-3;\r\n\t\t\t\t\t&:hover {\r\n\t\t\t\t\t\tbackground-color: $--color-primary-light-5;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t&.sep {\r\n\t\t\t\t\tdisplay: flex !important;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tuser-select: none;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t&.logText {\r\n\t\t\t\tpadding: 16px 0px;\r\n\t\t\t\tuser-select: none;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tword-break: break-all;\r\n\t\t\t}\r\n\r\n\t\t\t.buttonText {\r\n\t\t\t\tcolor: $--color-primary-light-3 !important;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n.foter {\r\n\tposition: absolute;\r\n\tbottom: 0px;\r\n\tfont-size: $--font-size-extra-small;\r\n\tcolor: rgba($color: white, $alpha: 0.5);\r\n\tpadding: 16px 0px;\r\n\t&.left {\r\n\t\tleft: 10px;\r\n\t\ttext-align: left;\r\n\t}\r\n\t&.right {\r\n\t\tright: 10px;\r\n\t\ttext-align: right;\r\n\t}\r\n}\r\n.acgirl {\r\n\tposition: absolute;\r\n\tright: 0px;\r\n\tbottom: 60px;\r\n}\r\n</style>\r\n","export default class Cookies {\r\n\tstatic set(key: string, value: any, ttl = 259200000): void {\r\n\t\tlocalStorage.setItem(\r\n\t\t\tkey,\r\n\t\t\tJSON.stringify({\r\n\t\t\t\tvalue,\r\n\t\t\t\texpiry: new Date().getTime() + ttl\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tstatic get(key: string): any | null {\r\n\t\ttry {\r\n\t\t\tconst { expiry, value }: any = JSON.parse(\r\n\t\t\t\tlocalStorage.getItem(key) || \"\"\r\n\t\t\t);\r\n\t\t\tif (expiry > new Date().getTime()) return value;\r\n\t\t\tlocalStorage.removeItem(key);\r\n\t\t\treturn null;\r\n\t\t} catch (error) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}\r\n","<template>\r\n\t<div id=\"topbar\">\r\n\t\t<div class=\"handler\">\r\n\t\t\t<handler-moving>\r\n\t\t\t\t<span class=\"el-icon-more-outline\" />\r\n\t\t\t</handler-moving>\r\n\t\t</div>\r\n\t\t<div class=\"button el-icon-minus\" @click=\"minimize()\" />\r\n\t\t<div class=\"button el-icon-close\" @click=\"close()\" />\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, defineAsyncComponent } from \"vue\";\r\nimport { minimize, close } from \"@front/util_function/system\";\r\nconst HandlerMoving = defineAsyncComponent(() =>\r\n\timport(\"@front/components/system/HandlerMoving.vue\")\r\n);\r\nexport default defineComponent({\r\n\tname: \"topbarBase\",\r\n\tcomponents: {\r\n\t\tHandlerMoving\r\n\t},\r\n\tmethods: {\r\n\t\tminimize,\r\n\t\tclose\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped lang='scss'>\r\n#topbar {\r\n\twidth: 100%;\r\n\theight: 24px;\r\n\tdisplay: flex;\r\n\tposition: relative;\r\n\ttransition: background-color 0.25s;\r\n\tcursor: move;\r\n\t&:hover {\r\n\t\tbackground: rgba(0, 0, 0, 0.05);\r\n\t}\r\n\t.handler {\r\n\t\tposition: relative;\r\n\t\tflex-grow: 1;\r\n\t\tcolor: white;\r\n\t}\r\n\t.button {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tcursor: pointer;\r\n\t\tborder: none;\r\n\t\tbackground-color: rgba(0, 0, 0, 0);\r\n\t\tfont-size: 14px;\r\n\t\tcolor: white;\r\n\t\tborder-radius: 0px;\r\n\t\tpadding: 2px 8px;\r\n\t\tmargin: 0px;\r\n\t\ttransition: background-color 0.25s;\r\n\t\t&:hover {\r\n\t\t\tbackground-color: rgba(0, 0, 0, 0.25);\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent, defineAsyncComponent } from \"vue\";\r\nimport { minimize, close } from \"@front/util_function/system\";\r\nconst HandlerMoving = defineAsyncComponent(() =>\r\n\timport(\"@front/components/system/HandlerMoving.vue\")\r\n);\r\nexport default defineComponent({\r\n\tname: \"topbarBase\",\r\n\tcomponents: {\r\n\t\tHandlerMoving\r\n\t},\r\n\tmethods: {\r\n\t\tminimize,\r\n\t\tclose\r\n\t}\r\n});\r\n","import { render } from \"./base.vue?vue&type=template&id=5f1e490e&scoped=true\"\nimport script from \"./base.vue?vue&type=script&lang=ts\"\nexport * from \"./base.vue?vue&type=script&lang=ts\"\n\nimport \"./base.vue?vue&type=style&index=0&id=5f1e490e&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-5f1e490e\"\n\nexport default script","\r\nimport { defineComponent } from \"vue\";\r\nimport Cookies from \"@front/util_function/cookies\";\r\nimport topbarBase from \"@front/components/system/topbars/base.vue\";\r\nimport { loadConfig, launch } from \"@front/util_function/system\";\r\nimport { assign } from \"@front/util_function/base\";\r\nimport { login, loginSession } from \"@front/api/user\";\r\nimport { getManagerList } from \"@front/api/room\";\r\nimport { isOnline } from \"@front/api/utils/websocket\";\r\nimport { login as loginTexts, common } from \"@front/texts\";\r\n\r\nexport default defineComponent({\r\n\tname: \"login\",\r\n\tcomponents: {\r\n\t\ttopbarBase\r\n\t},\r\n\tdata() {\r\n\t\tconst checkTimer: any = null;\r\n\t\treturn {\r\n\t\t\tuserData: {\r\n\t\t\t\taccount: \"\",\r\n\t\t\t\tpassword: \"\",\r\n\t\t\t\tkeepLogined: false,\r\n\t\t\t\tdisclaimerCheck: false\r\n\t\t\t},\r\n\t\t\tcommon: common(),\r\n\t\t\tdisclaimerDialog: false,\r\n\t\t\tlogining: false,\r\n\t\t\tserveOnline: false,\r\n\t\t\tcheckTimer,\r\n\t\t\tloginFailedText: \"\",\r\n\t\t\twelcome: false,\r\n\t\t\twelcomeLogoKey: \"111\"\r\n\t\t} as Record<string, any>;\r\n\t},\r\n\tcomputed: {\r\n\t\tloginTexts,\r\n\t\tloginDisabled(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck ||\r\n\t\t\t\tthis.logining\r\n\t\t\t);\r\n\t\t},\r\n\t\tloginText(): string {\r\n\t\t\tif (this.logining) {\r\n\t\t\t\treturn \"登陆中...\";\r\n\t\t\t}\r\n\t\t\tif (this.loginFailedText) {\r\n\t\t\t\treturn `登陆失败： ${this.loginFailedText}`;\r\n\t\t\t}\r\n\t\t\tif (this.serveOnline) {\r\n\t\t\t\treturn \"服务端已连接\";\r\n\t\t\t}\r\n\t\t\treturn \"服务端离线,请尝试关闭工具箱并右键以管理员权限打开\";\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.getCookie();\r\n\t\tthis.autoLogin();\r\n\t\tloadConfig().then((res: any) => {\r\n\t\t\tif (res) {\r\n\t\t\t\tassign(this.$store.state.danmakuProfile, res);\r\n\t\t\t}\r\n\t\t\tif (res?.general?.streamToolEnable) {\r\n\t\t\t\tlaunch(res?.general?.streamToolPath);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.checkOnline();\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearInterval(this.checkTimer);\r\n\t},\r\n\tmethods: {\r\n\t\tcheckOnline() {\r\n\t\t\tisOnline().then(res => (this.serveOnline = res));\r\n\t\t\tthis.checkTimer = setTimeout(this.checkOnline, 5000);\r\n\t\t},\r\n\t\tautoLogin(): void {\r\n\t\t\tif (\r\n\t\t\t\tthis.getCookie() &&\r\n\t\t\t\tthis.userData.keepLogined &&\r\n\t\t\t\tsessionStorage.getItem(\"firstTime\") !== \"false\"\r\n\t\t\t) {\r\n\t\t\t\tthis.login();\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync login() {\r\n\t\t\tthis.logining = true;\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\tthis.logining = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet tokenInfo: any = this.$store.state.userSession;\r\n\t\t\tloginSession(tokenInfo);\r\n\t\t\ttry {\r\n\t\t\t\tawait getManagerList();\r\n\t\t\t} catch (error) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\ttokenInfo = await login(this.userData);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t// TODO: Confirm the type of error, loginFailedText.\r\n\t\t\t\t\tthis.loginFailedText = error;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userData = this.userData;\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\tsessionStorage.setItem(\"logined\", \"true\");\r\n\t\t\tsessionStorage.setItem(\"firstTime\", \"false\");\r\n\t\t\tif (this.userData.keepLogined) {\r\n\t\t\t\tthis.setCookie(tokenInfo);\r\n\t\t\t}\r\n\t\t\tthis.$store.dispatch(\"login\");\r\n\t\t\tthis.$router.replace(\"dashboard\");\r\n\t\t},\r\n\t\tgetCookie() {\r\n\t\t\tconst userData = Cookies.get(\"userData\");\r\n\t\t\tconst tokenInfo = Cookies.get(\"tokenInfo\");\r\n\t\t\tif (userData) {\r\n\t\t\t\tthis.userData = userData;\r\n\t\t\t}\r\n\t\t\tif (!tokenInfo?.serviceToken) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tsetCookie(tokenInfo: any) {\r\n\t\t\tconst expiry = 2 * 60 * 60 * 24 * 1000;\r\n\t\t\tconst expiry2 = 60 * 60 * 60 * 24 * 1000;\r\n\t\t\tCookies.set(\"userData\", this.userData, expiry2);\r\n\t\t\tCookies.set(\"tokenInfo\", tokenInfo, expiry);\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tif (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=78ba6ecd&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=78ba6ecd&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-78ba6ecd\"\n\nexport default script","export * from \"-!../../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./base.vue?vue&type=style&index=0&id=5f1e490e&scoped=true&lang=scss\""],"sourceRoot":""}