{"version":3,"sources":["webpack:///./src/electron_browser/components/superChat/index.vue?b197","webpack:///./src/electron_browser/views/danmakuWeb/index.vue","webpack:///./src/electron_browser/views/danmakuWeb/index.vue?a23d","webpack:///./src/electron_browser/views/danmakuWeb/index.vue?d067","webpack:///./src/electron_browser/components/superChat/index.vue","webpack:///./src/electron_browser/components/superChat/index.vue?04c7","webpack:///./src/electron_browser/components/superChat/index.vue?0dd8","webpack:///./src/electron_browser/views/danmakuWeb/index.vue?aba6"],"names":["style","class","enable","superChatEnable","settings","danmakuProfile","web","danmakuList","danmakuSession","filterFlow","name","mode","pos","key","dotsCount","dot","checkers","checker","label","value","components","flow","superChatList","superChat","statusTimer","that","this","settingTimer","reconnect","status","isOnline","method","refresh","wait","registered","registerWS","logined","login","hasSession","requestSession","hasSetting","updateSettings","isStreaming","requestStreaming","hasRank","danmakuing","startDanmaku","$store","state","isLogined","registerEvents","dispatch","then","unRegisterEvents","computed","Object","values","item","methods","clearTimeout","forEach","window","wsl","close","on","updateSession","updateRank","updateManager","checkServerState","off","Promise","resolve","account","password","streamStatus","step","statusLooper","location","reload","next","setTimeout","res","register","userSession","userID","wsEmit","streamInfo","Error","profile","assign","userProfile","roomProfile","liveID","fetch","cache","json","common","temp","finally","session","Boolean","rank","managerList","list","length","push","mock","liverUID","type","data","danmuInfo","sendTime","userInfo","nickname","avatar","medal","uperID","clubName","level","managerType","content","i","render","superChatArray","scBlock","selectedID","superChatID","select","displayType","uid","sc-block","currentTime","remove","superChatBlock","listBlock","listPanel","timeCounter","count","update","Date","now","nextOne","find","block","showed","listEndTime","time","panelEndTime","filter","blockI","__scopeId"],"mappings":"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","file":"js/chunk-04e65334.974995f8.js","sourcesContent":["export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=1f5c0cb6&scoped=true&lang=scss\"","<template>\r\n\t<div style=\"width:100%;height:100%;position:relative\">\r\n\t\t<super-chat-list class=\"super-chat\" v-if=\"enable&&superChatEnable\" />\r\n\t\t<flow v-if=\"enable\" :class=\"{superChatEnable}\" :settings=\"danmakuProfile.web\" :danmakuList=\"danmakuSession.filterFlow\" />\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<div class=\"tips\" v-if=\"!enable\">\r\n\t\t\t\t<div class=\"positioner\" :class=\"pos\" v-for=\"pos in ['lt','rt','lb','rb']\" :key=\"pos\" />\r\n\t\t\t\t<div class=\"title\">弹幕准备中。<span v-for=\"dot in dotsCount\" :key=\"dot\">。</span></div>\r\n\t\t\t\t<div v-for=\"checker of checkers\" :key=\"checker.label\" class=\"checkers\">\r\n\t\t\t\t\t<div class=\"label\">{{checker.label}}</div>\r\n\t\t\t\t\t<div class=\"status\" :class=\"checker.value?'el-icon-circle-check success':'el-icon-circle-close failed'\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</transition>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { wsevent, user, server } from \"@front/api\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nimport { commonSettings } from \"@front/datas/danmaku\";\r\nimport { tempInfo } from \"@front/datas/temp\";\r\nimport flow from \"@front/components/danmakuFlow/index.vue\";\r\nimport { mapState, mapGetters } from \"vuex\";\r\nimport superChatList from \"@front/components/superChat/index.vue\";\r\nimport { registerRole } from \"@front/util_function/base\";\r\nexport default defineComponent({\r\n\tname: \"webDanmaku\",\r\n\tcomponents: {\r\n\t\tflow,\r\n\t\tsuperChatList\r\n\t},\r\n\tdata() {\r\n\t\tconst danmakuList: any = [];\r\n\t\tconst statusTimer: any = null;\r\n\t\t// @ts-ignore\r\n\t\tconst that: any = this;\r\n\t\treturn {\r\n\t\t\tdanmakuList,\r\n\t\t\tstatusTimer,\r\n\t\t\tsettingTimer: false,\r\n\t\t\tdotsCount: 0,\r\n\t\t\treconnect: false,\r\n\t\t\tstatus: {\r\n\t\t\t\tisOnline: {\r\n\t\t\t\t\tlabel: \"连接在线\",\r\n\t\t\t\t\tmethod: that.refresh,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 2000\r\n\t\t\t\t},\r\n\t\t\t\tregistered: {\r\n\t\t\t\t\tlabel: \"通信注册\",\r\n\t\t\t\t\tmethod: that.registerWS,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tlogined: {\r\n\t\t\t\t\tlabel: \"登陆\",\r\n\t\t\t\t\tmethod: that.login,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\thasSession: {\r\n\t\t\t\t\tlabel: \"主播信息\",\r\n\t\t\t\t\tmethod: that.requestSession,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\thasSetting: {\r\n\t\t\t\t\tlabel: \"弹幕设置\",\r\n\t\t\t\t\tmethod: that.updateSettings,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\tisStreaming: {\r\n\t\t\t\t\tlabel: \"直播状态\",\r\n\t\t\t\t\tmethod: that.requestStreaming,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\thasRank: {\r\n\t\t\t\t\tlabel: \"牌子信息\",\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tdanmakuing: {\r\n\t\t\t\t\tlabel: \"弹幕启动\",\r\n\t\t\t\t\tmethod: that.startDanmaku,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 30000\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.$store.state.isLogined = true;\r\n\t\tthis.registerEvents();\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$store.dispatch(\"startServe\").then(() => {\r\n\t\t\tthis.registerWS();\r\n\t\t});\r\n\t\tregisterRole(\"网页端\");\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tthis.unRegisterEvents();\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters([\"superChatEnable\"]),\r\n\t\t...mapState([\r\n\t\t\t\"userSession\",\r\n\t\t\t\"danmakuProfile\",\r\n\t\t\t\"rank\",\r\n\t\t\t\"streamStatus\",\r\n\t\t\t\"danmakuSession\"\r\n\t\t]),\r\n\t\tcheckers(): Array<any> {\r\n\t\t\treturn Object.values(this.status);\r\n\t\t},\r\n\t\tenable(): boolean {\r\n\t\t\tfor (const item of Object.values(this.status)) {\r\n\t\t\t\tif (!item.value) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trefresh() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.checkers.forEach((checker: any) => {\r\n\t\t\t\tchecker.value = false;\r\n\t\t\t});\r\n\t\t\tif (server.isOnline()) {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\twindow.wsl.close();\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterEvents() {\r\n\t\t\twsevent.on(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.on(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.on(\"update-manager\", this.updateManager);\r\n\t\t\twsevent.on(\"registered\", () => {\r\n\t\t\t\tthis.status.registered.value = true;\r\n\t\t\t});\r\n\t\t\tevent.on(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tunRegisterEvents() {\r\n\t\t\twsevent.off(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.off(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.off(\"update-manager\", this.updateManager);\r\n\t\t\tevent.off(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tlogin() {\r\n\t\t\treturn new Promise(resolve => {\r\n\t\t\t\tuser.login({\r\n\t\t\t\t\taccount: \"\",\r\n\t\t\t\t\tpassword: \"\"\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\tthis.status.logined.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tcheckServerState() {\r\n\t\t\tswitch (this.streamStatus.step) {\r\n\t\t\t\tcase \"online\":\r\n\t\t\t\t\tthis.status.isOnline.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"danmakuing\":\r\n\t\t\t\t\tthis.status.danmakuing.value = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"streamEnded\":\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tstatusLooper() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.dotsCount = (this.dotsCount + 1) % 4;\r\n\t\t\tlet wait = 500;\r\n\t\t\tconst next = () => {\r\n\t\t\t\tthis.statusTimer = setTimeout(() => {\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t}, wait);\r\n\t\t\t};\r\n\t\t\tfor (const checker of this.checkers) {\r\n\t\t\t\tif (!checker.value) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (checker.method) {\r\n\t\t\t\t\t\tconst res = checker.method();\r\n\t\t\t\t\t\tif (res instanceof Promise) {\r\n\t\t\t\t\t\t\tres.then(next);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twait = checker.wait;\r\n\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterWS() {\r\n\t\t\twsevent.register(\"client\");\r\n\t\t},\r\n\t\trequestSession() {\r\n\t\t\tif (!this.userSession.userID) {\r\n\t\t\t\twsevent.wsEmit(\"get-session\", {}, \"server\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\trequestSettings() {\r\n\t\t\twsevent.wsEmit(\"get-settings\", {}, \"server\");\r\n\t\t},\r\n\t\trequestStreaming() {\r\n\t\t\tif (!this.status.isStreaming.value) {\r\n\t\t\t\tconst state = this.$store.state;\r\n\t\t\t\tuser.streamInfo(state.userSession).then(res => {\r\n\t\t\t\t\tif (!res) {\r\n\t\t\t\t\t\tthrow new Error(\"no streamInfo\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (res.profile) {\r\n\t\t\t\t\t\tObject.assign(state.userProfile, res.profile);\r\n\t\t\t\t\t\tdelete res.profile;\r\n\t\t\t\t\t\tObject.assign(state.roomProfile, res);\r\n\t\t\t\t\t\tif (res.liveID) {\r\n\t\t\t\t\t\t\tthis.status.isStreaming.value = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateSettings() {\r\n\t\t\tif (this.settingTimer) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.settingTimer = true;\r\n\t\t\tfetch(\"/configFiles/config.json\", {\r\n\t\t\t\tcache: \"no-cache\"\r\n\t\t\t})\r\n\t\t\t\t.then((res: any) => res.json())\r\n\t\t\t\t.then((json: any) => {\r\n\t\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.web = json.web;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.common =\r\n\t\t\t\t\t\tjson.common || commonSettings();\r\n\t\t\t\t\tthis.$store.state.temp = tempInfo();\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.settingTimer = false;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tupdateSession(session: any) {\r\n\t\t\tif (\r\n\t\t\t\tthis.status.hasSession.value &&\r\n\t\t\t\tthis.userSession.userID !== session.userID\r\n\t\t\t) {\r\n\t\t\t\tthis.refresh();\r\n\t\t\t}\r\n\t\t\tif ((this.status.hasSession.value = Boolean(session))) {\r\n\t\t\t\tthis.$store.state.userSession = session;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateRank(rank: any) {\r\n\t\t\tif ((this.status.hasRank.value = Boolean(rank))) {\r\n\t\t\t\tthis.$store.state.rank = rank;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateManager(res: any) {\r\n\t\t\tthis.$store.state.managerList = res.list;\r\n\t\t},\r\n\t\tstartDanmaku() {\r\n\t\t\tthis.$store.dispatch(\"streaming\");\r\n\t\t\tif (!this.danmakuSession.filterFlow.length) {\r\n\t\t\t\tthis.danmakuSession.filterFlow.push({\r\n\t\t\t\t\tmock: true,\r\n\t\t\t\t\tliverUID: 23682490,\r\n\t\t\t\t\ttype: 1000,\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tdanmuInfo: {\r\n\t\t\t\t\t\t\tsendTime: 1618750176864,\r\n\t\t\t\t\t\t\tuserInfo: {\r\n\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\tnickname: \"ACFUN前后端开源⑨课\",\r\n\t\t\t\t\t\t\t\tavatar:\r\n\t\t\t\t\t\t\t\t\t\"https://tx-free-imgs.acfun.cn/FllI0yyjNgQ61QdJJdbIh9cRQIYY?imageMogr2/auto-orient/format/webp/quality/75!/ignore-error/1\",\r\n\t\t\t\t\t\t\t\tmedal: {\r\n\t\t\t\t\t\t\t\t\tuperID: 23682490,\r\n\t\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\t\tclubName: \"ACER\",\r\n\t\t\t\t\t\t\t\t\tlevel: 999\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tmanagerType: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcontent: \"弹幕流启动成功！直播开始啦开始啦！\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\treWait() {\r\n\t\t\t[\"hasSession\", \"isStreaming\", \"hasRank\", \"danmakuing\"].forEach(\r\n\t\t\t\t(i: any) => {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tthis.status[i].value = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n<style lang='scss'>\r\n@import \"@front/styles/variables.scss\";\r\nhtml,\r\nbody,\r\n#app {\r\n\tbackground-color: transparent;\r\n\tmin-width: 0px;\r\n\tmin-height: 0px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tpadding: 0px;\r\n}\r\n#app {\r\n\tmargin: 0px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\ttransition: none;\r\n}\r\n.danmaku-flow {\r\n\tpadding-bottom: 16px !important;\r\n}\r\n.superChatEnable {\r\n\theight: calc(100% - 40px);\r\n}\r\n.super-chat {\r\n\tborder: none !important;\r\n\tmargin-bottom: 5px;\r\n}\r\n.tips {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tcolor: white;\r\n\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\tfont-weight: 700;\r\n\tfont-size: 24px;\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\t.title {\r\n\t\tfont-size: 32px;\r\n\t\tmargin-bottom: 15px;\r\n\t\tmargin-left: 50px;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.checkers {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 15px;\r\n\t\t.failed {\r\n\t\t\tcolor: $--color-danger;\r\n\t\t}\r\n\t\t.success {\r\n\t\t\tcolor: $--color-success;\r\n\t\t}\r\n\t\t.label {\r\n\t\t\twidth: 150px;\r\n\t\t}\r\n\t}\r\n\t.positioner {\r\n\t\tposition: absolute;\r\n\t\tborder-style: solid;\r\n\t\tborder-color: white;\r\n\t\theight: 5%;\r\n\t\twidth: 5%;\r\n\r\n\t\t&.lt {\r\n\t\t\ttop: 0px;\r\n\t\t\tleft: 0px;\r\n\t\t\tborder-width: 5px 0px 0px 5px;\r\n\t\t}\r\n\t\t&.rt {\r\n\t\t\ttop: 0px;\r\n\t\t\tright: 0px;\r\n\t\t\tborder-width: 5px 5px 0px 0px;\r\n\t\t}\r\n\t\t&.lb {\r\n\t\t\tbottom: 0px;\r\n\t\t\tleft: 0px;\r\n\t\t\tborder-width: 0px 0px 5px 5px;\r\n\t\t}\r\n\t\t&.rb {\r\n\t\t\tbottom: 0px;\r\n\t\t\tright: 0px;\r\n\t\t\tborder-width: 0px 5px 5px 0px;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from \"vue\";\r\nimport { wsevent, user, server } from \"@front/api\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nimport { commonSettings } from \"@front/datas/danmaku\";\r\nimport { tempInfo } from \"@front/datas/temp\";\r\nimport flow from \"@front/components/danmakuFlow/index.vue\";\r\nimport { mapState, mapGetters } from \"vuex\";\r\nimport superChatList from \"@front/components/superChat/index.vue\";\r\nimport { registerRole } from \"@front/util_function/base\";\r\nexport default defineComponent({\r\n\tname: \"webDanmaku\",\r\n\tcomponents: {\r\n\t\tflow,\r\n\t\tsuperChatList\r\n\t},\r\n\tdata() {\r\n\t\tconst danmakuList: any = [];\r\n\t\tconst statusTimer: any = null;\r\n\t\t// @ts-ignore\r\n\t\tconst that: any = this;\r\n\t\treturn {\r\n\t\t\tdanmakuList,\r\n\t\t\tstatusTimer,\r\n\t\t\tsettingTimer: false,\r\n\t\t\tdotsCount: 0,\r\n\t\t\treconnect: false,\r\n\t\t\tstatus: {\r\n\t\t\t\tisOnline: {\r\n\t\t\t\t\tlabel: \"连接在线\",\r\n\t\t\t\t\tmethod: that.refresh,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 2000\r\n\t\t\t\t},\r\n\t\t\t\tregistered: {\r\n\t\t\t\t\tlabel: \"通信注册\",\r\n\t\t\t\t\tmethod: that.registerWS,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tlogined: {\r\n\t\t\t\t\tlabel: \"登陆\",\r\n\t\t\t\t\tmethod: that.login,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\thasSession: {\r\n\t\t\t\t\tlabel: \"主播信息\",\r\n\t\t\t\t\tmethod: that.requestSession,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\thasSetting: {\r\n\t\t\t\t\tlabel: \"弹幕设置\",\r\n\t\t\t\t\tmethod: that.updateSettings,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\tisStreaming: {\r\n\t\t\t\t\tlabel: \"直播状态\",\r\n\t\t\t\t\tmethod: that.requestStreaming,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\thasRank: {\r\n\t\t\t\t\tlabel: \"牌子信息\",\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tdanmakuing: {\r\n\t\t\t\t\tlabel: \"弹幕启动\",\r\n\t\t\t\t\tmethod: that.startDanmaku,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 30000\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.$store.state.isLogined = true;\r\n\t\tthis.registerEvents();\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$store.dispatch(\"startServe\").then(() => {\r\n\t\t\tthis.registerWS();\r\n\t\t});\r\n\t\tregisterRole(\"网页端\");\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tthis.unRegisterEvents();\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters([\"superChatEnable\"]),\r\n\t\t...mapState([\r\n\t\t\t\"userSession\",\r\n\t\t\t\"danmakuProfile\",\r\n\t\t\t\"rank\",\r\n\t\t\t\"streamStatus\",\r\n\t\t\t\"danmakuSession\"\r\n\t\t]),\r\n\t\tcheckers(): Array<any> {\r\n\t\t\treturn Object.values(this.status);\r\n\t\t},\r\n\t\tenable(): boolean {\r\n\t\t\tfor (const item of Object.values(this.status)) {\r\n\t\t\t\tif (!item.value) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trefresh() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.checkers.forEach((checker: any) => {\r\n\t\t\t\tchecker.value = false;\r\n\t\t\t});\r\n\t\t\tif (server.isOnline()) {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\twindow.wsl.close();\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterEvents() {\r\n\t\t\twsevent.on(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.on(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.on(\"update-manager\", this.updateManager);\r\n\t\t\twsevent.on(\"registered\", () => {\r\n\t\t\t\tthis.status.registered.value = true;\r\n\t\t\t});\r\n\t\t\tevent.on(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tunRegisterEvents() {\r\n\t\t\twsevent.off(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.off(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.off(\"update-manager\", this.updateManager);\r\n\t\t\tevent.off(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tlogin() {\r\n\t\t\treturn new Promise(resolve => {\r\n\t\t\t\tuser.login({\r\n\t\t\t\t\taccount: \"\",\r\n\t\t\t\t\tpassword: \"\"\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\tthis.status.logined.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tcheckServerState() {\r\n\t\t\tswitch (this.streamStatus.step) {\r\n\t\t\t\tcase \"online\":\r\n\t\t\t\t\tthis.status.isOnline.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"danmakuing\":\r\n\t\t\t\t\tthis.status.danmakuing.value = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"streamEnded\":\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tstatusLooper() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.dotsCount = (this.dotsCount + 1) % 4;\r\n\t\t\tlet wait = 500;\r\n\t\t\tconst next = () => {\r\n\t\t\t\tthis.statusTimer = setTimeout(() => {\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t}, wait);\r\n\t\t\t};\r\n\t\t\tfor (const checker of this.checkers) {\r\n\t\t\t\tif (!checker.value) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (checker.method) {\r\n\t\t\t\t\t\tconst res = checker.method();\r\n\t\t\t\t\t\tif (res instanceof Promise) {\r\n\t\t\t\t\t\t\tres.then(next);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twait = checker.wait;\r\n\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterWS() {\r\n\t\t\twsevent.register(\"client\");\r\n\t\t},\r\n\t\trequestSession() {\r\n\t\t\tif (!this.userSession.userID) {\r\n\t\t\t\twsevent.wsEmit(\"get-session\", {}, \"server\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\trequestSettings() {\r\n\t\t\twsevent.wsEmit(\"get-settings\", {}, \"server\");\r\n\t\t},\r\n\t\trequestStreaming() {\r\n\t\t\tif (!this.status.isStreaming.value) {\r\n\t\t\t\tconst state = this.$store.state;\r\n\t\t\t\tuser.streamInfo(state.userSession).then(res => {\r\n\t\t\t\t\tif (!res) {\r\n\t\t\t\t\t\tthrow new Error(\"no streamInfo\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (res.profile) {\r\n\t\t\t\t\t\tObject.assign(state.userProfile, res.profile);\r\n\t\t\t\t\t\tdelete res.profile;\r\n\t\t\t\t\t\tObject.assign(state.roomProfile, res);\r\n\t\t\t\t\t\tif (res.liveID) {\r\n\t\t\t\t\t\t\tthis.status.isStreaming.value = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateSettings() {\r\n\t\t\tif (this.settingTimer) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.settingTimer = true;\r\n\t\t\tfetch(\"/configFiles/config.json\", {\r\n\t\t\t\tcache: \"no-cache\"\r\n\t\t\t})\r\n\t\t\t\t.then((res: any) => res.json())\r\n\t\t\t\t.then((json: any) => {\r\n\t\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.web = json.web;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.common =\r\n\t\t\t\t\t\tjson.common || commonSettings();\r\n\t\t\t\t\tthis.$store.state.temp = tempInfo();\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.settingTimer = false;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tupdateSession(session: any) {\r\n\t\t\tif (\r\n\t\t\t\tthis.status.hasSession.value &&\r\n\t\t\t\tthis.userSession.userID !== session.userID\r\n\t\t\t) {\r\n\t\t\t\tthis.refresh();\r\n\t\t\t}\r\n\t\t\tif ((this.status.hasSession.value = Boolean(session))) {\r\n\t\t\t\tthis.$store.state.userSession = session;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateRank(rank: any) {\r\n\t\t\tif ((this.status.hasRank.value = Boolean(rank))) {\r\n\t\t\t\tthis.$store.state.rank = rank;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateManager(res: any) {\r\n\t\t\tthis.$store.state.managerList = res.list;\r\n\t\t},\r\n\t\tstartDanmaku() {\r\n\t\t\tthis.$store.dispatch(\"streaming\");\r\n\t\t\tif (!this.danmakuSession.filterFlow.length) {\r\n\t\t\t\tthis.danmakuSession.filterFlow.push({\r\n\t\t\t\t\tmock: true,\r\n\t\t\t\t\tliverUID: 23682490,\r\n\t\t\t\t\ttype: 1000,\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tdanmuInfo: {\r\n\t\t\t\t\t\t\tsendTime: 1618750176864,\r\n\t\t\t\t\t\t\tuserInfo: {\r\n\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\tnickname: \"ACFUN前后端开源⑨课\",\r\n\t\t\t\t\t\t\t\tavatar:\r\n\t\t\t\t\t\t\t\t\t\"https://tx-free-imgs.acfun.cn/FllI0yyjNgQ61QdJJdbIh9cRQIYY?imageMogr2/auto-orient/format/webp/quality/75!/ignore-error/1\",\r\n\t\t\t\t\t\t\t\tmedal: {\r\n\t\t\t\t\t\t\t\t\tuperID: 23682490,\r\n\t\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\t\tclubName: \"ACER\",\r\n\t\t\t\t\t\t\t\t\tlevel: 999\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tmanagerType: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcontent: \"弹幕流启动成功！直播开始啦开始啦！\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\treWait() {\r\n\t\t\t[\"hasSession\", \"isStreaming\", \"hasRank\", \"danmakuing\"].forEach(\r\n\t\t\t\t(i: any) => {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tthis.status[i].value = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=26bfe96e\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=26bfe96e&lang=scss\"\nscript.render = render\n\nexport default script","<template>\r\n\t<div class=\"super-chat-list\">\r\n\t\t<div class=\"super-chat-list-row\">\r\n\t\t\t<list-block :selectedID=\"temp.superChatID\" @click=\"select(scBlock,5000)\" :displayType=\"displayType\" v-for=\"scBlock in temp.superChatArray\" :key=\"scBlock.uid\" :sc-block=\"scBlock\" :currentTime=\"currentTime\" @end=\"remove(scBlock)\" />\r\n\t\t</div>\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<list-panel class=\"super-chat-panel\" :displayType=\"displayType\" :key=\"temp.superChatID\" v-if=\"temp.superChatBlock\" :sc-block=\"temp.superChatBlock\" :currentTime=\"currentTime\" @next=\"next()\" />\r\n\t\t</transition>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { mapState } from \"vuex\";\r\nimport listBlock from \"./listBlock.vue\";\r\nimport listPanel from \"./listPanel.vue\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nexport default defineComponent({\r\n\tname: \"superChatList\",\r\n\tcomponents: { listBlock, listPanel },\r\n\tdata() {\r\n\t\tconst timeCounter: any = null;\r\n\t\treturn {\r\n\t\t\tcurrentTime: 0,\r\n\t\t\ttimeCounter\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.count();\r\n\t\tevent.on(\"super-chat-updated\", this.update);\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearTimeout(this.timeCounter);\r\n\t\tevent.off(\"super-chat-updated\", this.update);\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState([\"temp\", \"danmakuProfile\"]),\r\n\t\tsuperChatArray(): Array<any> {\r\n\t\t\treturn this.temp.superChatArray;\r\n\t\t},\r\n\t\tdisplayType(): number {\r\n\t\t\treturn this.danmakuProfile.common?.superChat?.displayType || 0;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tupdate() {\r\n\t\t\tif (this.temp.superChatID) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.next();\r\n\t\t},\r\n\t\tcount() {\r\n\t\t\tclearTimeout(this.timeCounter);\r\n\t\t\tthis.currentTime = Date.now();\r\n\t\t\tthis.timeCounter = setTimeout(() => {\r\n\t\t\t\tthis.count();\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\t\tnext() {\r\n\t\t\tconst nextOne = this.temp.superChatArray.find(\r\n\t\t\t\t(block: any) => !block.showed\r\n\t\t\t);\r\n\t\t\tif (\r\n\t\t\t\t!nextOne &&\r\n\t\t\t\tthis.currentTime > this.temp.superChatBlock.listEndTime\r\n\t\t\t) {\r\n\t\t\t\tthis.temp.superChatID = 0;\r\n\t\t\t\tthis.temp.superChatBlock = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.select(nextOne);\r\n\t\t\t}\r\n\t\t},\r\n\t\tselect(block: any, time = 20000) {\r\n\t\t\tblock.showed = true;\r\n\t\t\tblock.panelEndTime = Date.now() + time;\r\n\t\t\tif (block.listEndTime < block.panelEndTime) {\r\n\t\t\t\tblock.listEndTime = block.panelEndTime;\r\n\t\t\t}\r\n\t\t\tthis.temp.superChatID = block.uid;\r\n\t\t\tthis.temp.superChatBlock = block;\r\n\t\t},\r\n\t\tremove(block: any) {\r\n\t\t\tthis.temp.superChatArray = this.temp.superChatArray.filter(\r\n\t\t\t\t(blockI: any) => blockI !== block\r\n\t\t\t);\r\n\t\t\tif (block.uid === this.temp.superChatID) {\r\n\t\t\t\tthis.next();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped lang='scss'>\r\n@import \"@front/styles/variables.scss\";\r\n.super-chat-list {\r\n\tposition: relative;\r\n\twidth: 100%;\r\n\theight: 35px;\r\n\tbox-sizing: border-box;\r\n\tborder: $--border-base;\r\n\t.super-chat-list-row {\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tflex-wrap: wrap;\r\n\t\toverflow: hidden;\r\n\t\tpadding-left: 8px;\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from \"vue\";\r\nimport { mapState } from \"vuex\";\r\nimport listBlock from \"./listBlock.vue\";\r\nimport listPanel from \"./listPanel.vue\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nexport default defineComponent({\r\n\tname: \"superChatList\",\r\n\tcomponents: { listBlock, listPanel },\r\n\tdata() {\r\n\t\tconst timeCounter: any = null;\r\n\t\treturn {\r\n\t\t\tcurrentTime: 0,\r\n\t\t\ttimeCounter\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.count();\r\n\t\tevent.on(\"super-chat-updated\", this.update);\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearTimeout(this.timeCounter);\r\n\t\tevent.off(\"super-chat-updated\", this.update);\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState([\"temp\", \"danmakuProfile\"]),\r\n\t\tsuperChatArray(): Array<any> {\r\n\t\t\treturn this.temp.superChatArray;\r\n\t\t},\r\n\t\tdisplayType(): number {\r\n\t\t\treturn this.danmakuProfile.common?.superChat?.displayType || 0;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tupdate() {\r\n\t\t\tif (this.temp.superChatID) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.next();\r\n\t\t},\r\n\t\tcount() {\r\n\t\t\tclearTimeout(this.timeCounter);\r\n\t\t\tthis.currentTime = Date.now();\r\n\t\t\tthis.timeCounter = setTimeout(() => {\r\n\t\t\t\tthis.count();\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\t\tnext() {\r\n\t\t\tconst nextOne = this.temp.superChatArray.find(\r\n\t\t\t\t(block: any) => !block.showed\r\n\t\t\t);\r\n\t\t\tif (\r\n\t\t\t\t!nextOne &&\r\n\t\t\t\tthis.currentTime > this.temp.superChatBlock.listEndTime\r\n\t\t\t) {\r\n\t\t\t\tthis.temp.superChatID = 0;\r\n\t\t\t\tthis.temp.superChatBlock = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.select(nextOne);\r\n\t\t\t}\r\n\t\t},\r\n\t\tselect(block: any, time = 20000) {\r\n\t\t\tblock.showed = true;\r\n\t\t\tblock.panelEndTime = Date.now() + time;\r\n\t\t\tif (block.listEndTime < block.panelEndTime) {\r\n\t\t\t\tblock.listEndTime = block.panelEndTime;\r\n\t\t\t}\r\n\t\t\tthis.temp.superChatID = block.uid;\r\n\t\t\tthis.temp.superChatBlock = block;\r\n\t\t},\r\n\t\tremove(block: any) {\r\n\t\t\tthis.temp.superChatArray = this.temp.superChatArray.filter(\r\n\t\t\t\t(blockI: any) => blockI !== block\r\n\t\t\t);\r\n\t\t\tif (block.uid === this.temp.superChatID) {\r\n\t\t\t\tthis.next();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=1f5c0cb6&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=1f5c0cb6&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-1f5c0cb6\"\n\nexport default script","export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=26bfe96e&lang=scss\""],"sourceRoot":""}