{"version":3,"sources":["webpack://acfunlive-toolbox/./src/electron_browser/views/login/index.vue","webpack://acfunlive-toolbox/./src/electron_browser/util_function/cookies.ts","webpack://acfunlive-toolbox/./src/electron_browser/components/system/topbars/base.vue","webpack://acfunlive-toolbox/./src/electron_browser/components/system/topbars/base.vue?121f","webpack://acfunlive-toolbox/./src/electron_browser/components/system/topbars/base.vue?8ca9","webpack://acfunlive-toolbox/./src/electron_browser/views/login/index.vue?3d7a","webpack://acfunlive-toolbox/./src/electron_browser/views/login/index.vue?e697"],"names":["id","class","src","name","mode","welcome","loginTexts","welcomeLogo","welcomeLogoKey","welcomeText","userData","account","disabled","logining","login","placeholder","type","password","disclaimerCheck","disclaimerDialog","keepLogined","loginDisabled","key","loginText","custom-class","title","footer","size","disclaimer","common","version","Cookies","value","localStorage","setItem","getItem","minimize","close","HandlerMoving","defineAsyncComponent","defineComponent","components","methods","topbarBase","loginFailedText","computed","this","$store","state","api","streamStatus","step","getCookie","dispatch","then","autoLogin","res","danmakuProfile","general","streamToolEnable","streamToolPath","sessionStorage","isOnline","validation","setCookie","String","Math","random","setTimeout","$router","replace","catch","err","console","error","get","JSON","parse","stringify","render"],"mappings":"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","file":"js/872.33a7a1c9.js","sourcesContent":["<template>\r\n\t<div id=\"login\">\r\n\t\t<topbar-base class=\"topbar\" />\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<div class=\"panel\" v-if=\"!welcome\">\r\n\t\t\t\t<hero-base class=\"hero\" />\r\n\t\t\t\t<div class=\"form\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-input v-model=\"userData.account\" :disabled=\"logining\" @keypress.enter=\"login\" placeholder=\"A站邮箱/手机号\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-input type=\"password\" v-model=\"userData.password\" :disabled=\"logining\" @keypress.enter=\"login\" placeholder=\"A站密码\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row sep\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<el-checkbox class=\"logCheck\" v-model=\"userData.disclaimerCheck\" :disabled=\"logining\" />\r\n\t\t\t\t\t\t\t同意 ><el-button type=\"text\" class=\"buttonText\" @click=\"disclaimerDialog = true\" :disabled=\"logining\">免责声明\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<el-checkbox class=\"logCheck\" v-model=\"userData.keepLogined\" :disabled=\"logining\" />\r\n\t\t\t\t\t\t\t保持登录\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-button type=\"primary\" :disabled=\"loginDisabled\" class=\"logBtn\" @click=\"login\">登陆</el-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row logText\">\r\n\t\t\t\t\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t\t\t\t\t<div :key=\"loginText\">{{ loginText }}</div>\r\n\t\t\t\t\t\t</transition>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"welcome\" v-else>\r\n\t\t\t\t<img class=\"welcomeLogo\" :src=\"`${loginTexts.welcomeLogo}?a=${welcomeLogoKey}`\" />\r\n\t\t\t\t<div class=\"welcomeText\">{{ loginTexts.welcomeText }}</div>\r\n\t\t\t</div>\r\n\t\t</transition>\r\n\t\t<footer-base class=\"foter right\" />\r\n\t\t<el-dialog custom-class=\"dialogBase\" title=\"免责声明\" v-model=\"disclaimerDialog\">\r\n\t\t\t<div>{{ loginTexts.disclaimer }}</div>\r\n\t\t\t<template #footer>\r\n\t\t\t\t<el-button type=\"primary\" size=\"mini\" @click=\"\r\n\t\t\t\t\t\tuserData.disclaimerCheck = true;\r\n\t\t\t\t\t\tdisclaimerDialog = false;\r\n\t\t\t\t\t\">我同意</el-button>\r\n\t\t\t</template>\r\n\t\t</el-dialog>\r\n\t\t<img class=\"acgirl\" src=\"/imgs/common/welcome.png\" />\r\n\t\t<div class=\"foter left\">软件版本号：{{common.version}}</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport Cookies from \"@front/util_function/cookies\";\r\nimport topbarBase from \"@front/components/system/topbars/base.vue\";\r\nimport {\r\n\tbackendRestart,\r\n\tloadConfig,\r\n\tlaunch\r\n} from \"@front/util_function/system\";\r\nimport { assign } from \"@front/util_function/base\";\r\nimport { isOnline } from \"@front/api/server\";\r\nimport { login as loginTexts, common } from \"@front/texts\";\r\nexport default defineComponent({\r\n\tname: \"login\",\r\n\tcomponents: {\r\n\t\ttopbarBase\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tuserData: {\r\n\t\t\t\taccount: \"\",\r\n\t\t\t\tpassword: \"\",\r\n\t\t\t\tkeepLogined: false,\r\n\t\t\t\tdisclaimerCheck: false\r\n\t\t\t},\r\n\t\t\tcommon: common(),\r\n\t\t\tdisclaimerDialog: false,\r\n\t\t\tlogining: false,\r\n\t\t\tloginFailedText: \"\",\r\n\t\t\twelcome: false,\r\n\t\t\twelcomeLogoKey: \"111\"\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tloginTexts,\r\n\t\tapi(): any {\r\n\t\t\treturn this.$store.state.api;\r\n\t\t},\r\n\t\tloginDisabled(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck ||\r\n\t\t\t\tthis.logining ||\r\n\t\t\t\tthis.$store.state.streamStatus.step === \"offline\"\r\n\t\t\t);\r\n\t\t},\r\n\t\tloginText(): string {\r\n\t\t\tif (this.logining) {\r\n\t\t\t\treturn \"登陆中...\";\r\n\t\t\t}\r\n\t\t\tif (this.loginFailedText) {\r\n\t\t\t\treturn `登陆失败： ${this.loginFailedText}`;\r\n\t\t\t}\r\n\t\t\tif (this.$store.state.streamStatus.step !== \"offline\") {\r\n\t\t\t\treturn \"服务端已连接\";\r\n\t\t\t}\r\n\t\t\treturn \"服务端离线\";\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.getCookie();\r\n\t\tthis.$store.dispatch(\"startServe\").then(() => {\r\n\t\t\tthis.autoLogin();\r\n\t\t});\r\n\t\tloadConfig().then((res: any) => {\r\n\t\t\tif (res) {\r\n\t\t\t\tassign(this.$store.state.danmakuProfile, res);\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\tres?.general?.streamToolEnable &&\r\n\t\t\t\tres?.general?.streamToolPath\r\n\t\t\t) {\r\n\t\t\t\tlaunch(res?.general?.streamToolPath);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tmethods: {\r\n\t\tautoLogin(): void {\r\n\t\t\tif (\r\n\t\t\t\tthis.getCookie() &&\r\n\t\t\t\tthis.userData.keepLogined &&\r\n\t\t\t\tsessionStorage.getItem(\"firstTime\") !== \"false\"\r\n\t\t\t) {\r\n\t\t\t\tthis.login();\r\n\t\t\t}\r\n\t\t},\r\n\t\tlogin() {\r\n\t\t\tif (!isOnline()) {\r\n\t\t\t\tthis.$store\r\n\t\t\t\t\t.dispatch(\"startServe\")\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tthis.login();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((error: any) => {\r\n\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\tbackendRestart();\r\n\t\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.logining = true;\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.$store\r\n\t\t\t\t.dispatch(\"login\", this.userData)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis.$store.state.userData = this.userData;\r\n\t\t\t\t\tsessionStorage.setItem(\"logined\", \"true\");\r\n\t\t\t\t\tsessionStorage.setItem(\"firstTime\", \"false\");\r\n\t\t\t\t\tif (this.userData.keepLogined) {\r\n\t\t\t\t\t\tthis.setCookie();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.welcomeLogoKey = String(Math.random());\r\n\t\t\t\t\tthis.welcome = true;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.$router.replace(\"dashboard\");\r\n\t\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\t}, 4000);\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err: any) => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\tthis.loginFailedText = err;\r\n\t\t\t\t\t// backendRestart();\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tgetCookie() {\r\n\t\t\tconst userData = Cookies.get(\"userData\");\r\n\t\t\tif (!userData) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.userData = JSON.parse(userData);\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tsetCookie() {\r\n\t\t\tCookies.set(\"userData\", JSON.stringify(this.userData));\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tif (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@front/styles/variables.scss\";\r\n#login {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tfont-size: $--font-size-base;\r\n\tcolor: rgba($color: white, $alpha: 0.9);\r\n\tbackground-color: $--color-primary;\r\n\tbox-shadow: $--box-shadow-dark;\r\n\tborder-radius: $--border-radius-small;\r\n\t.topbar {\r\n\t\tposition: absolute;\r\n\t\ttop: 0px;\r\n\t}\r\n\t.welcome {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%) translateY(-50%);\r\n\t\tuser-select: none;\r\n\t\ttext-align: center;\r\n\t\t.welcomeLogo {\r\n\t\t\twidth: 200px;\r\n\t\t\tmargin-top: -200px;\r\n\t\t\tpointer-events: none;\r\n\t\t}\r\n\t\t.welcomeText {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 24px 0px;\r\n\t\t\tfont-size: $--font-size-extra-large;\r\n\t\t}\r\n\t}\r\n\t.panel {\r\n\t\tposition: absolute;\r\n\t\ttop: 215px;\r\n\t\tleft: 120px;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: flex-start;\r\n\t\tz-index: 100;\r\n\t\t.hero {\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 425px;\r\n\t\t\ttop: 121px;\r\n\t\t\twidth: calc(100vw - 645px);\r\n\t\t}\r\n\t\t.form {\r\n\t\t\tpadding: 24px 0px;\r\n\t\t\theight: 300px;\r\n\t\t\twidth: 300px;\r\n\t\t\t.row {\r\n\t\t\t\tpadding: 6px 0px;\r\n\t\t\t\t.logBtn {\r\n\t\t\t\t\twidth: 300px;\r\n\t\t\t\t\theight: 42px;\r\n\t\t\t\t\tbackground-color: $--color-primary-light-3;\r\n\t\t\t\t\t&:hover {\r\n\t\t\t\t\t\tbackground-color: $--color-primary-light-5;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t&.sep {\r\n\t\t\t\t\tdisplay: flex !important;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tuser-select: none;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t&.logText {\r\n\t\t\t\tpadding: 16px 0px;\r\n\t\t\t\tuser-select: none;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tword-break: break-all;\r\n\t\t\t}\r\n\r\n\t\t\t.buttonText {\r\n\t\t\t\tcolor: $--color-primary-light-3 !important;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n.foter {\r\n\tposition: absolute;\r\n\tbottom: 0px;\r\n\tfont-size: $--font-size-extra-small;\r\n\tcolor: rgba($color: white, $alpha: 0.5);\r\n\tpadding: 16px 0px;\r\n\t&.left {\r\n\t\tleft: 10px;\r\n\t\ttext-align: left;\r\n\t}\r\n\t&.right {\r\n\t\tright: 10px;\r\n\t\ttext-align: right;\r\n\t}\r\n}\r\n.acgirl {\r\n\tposition: absolute;\r\n\tright: 0px;\r\n\tbottom: 60px;\r\n}\r\n</style>\r\n","export default class Cookies {\r\n\tstatic set(key: string, value: string): void {\r\n\t\tlocalStorage.setItem(key, value);\r\n\t}\r\n\r\n\tstatic get(key: string): string | null {\r\n\t\treturn localStorage.getItem(key);\r\n\t}\r\n}\r\n","<template>\r\n\t<div id=\"topbar\">\r\n\t\t<div class=\"handler\">\r\n\t\t\t<handler-moving>\r\n\t\t\t\t<span class=\"el-icon-more-outline\" />\r\n\t\t\t</handler-moving>\r\n\t\t</div>\r\n\t\t<div class=\"button el-icon-minus\" @click=\"minimize()\" />\r\n\t\t<div class=\"button el-icon-close\" @click=\"close()\" />\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, defineAsyncComponent } from \"vue\";\r\nimport { minimize, close } from \"@front/util_function/system\";\r\nconst HandlerMoving = defineAsyncComponent(() =>\r\n\timport(\"@front/components/system/HandlerMoving.vue\")\r\n);\r\nexport default defineComponent({\r\n\tname: \"topbarBase\",\r\n\tcomponents: {\r\n\t\tHandlerMoving\r\n\t},\r\n\tmethods: {\r\n\t\tminimize,\r\n\t\tclose\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped lang='scss'>\r\n#topbar {\r\n\twidth: 100%;\r\n\theight: 24px;\r\n\tdisplay: flex;\r\n\tposition: relative;\r\n\ttransition: background-color 0.25s;\r\n\tcursor: move;\r\n\t&:hover {\r\n\t\tbackground: rgba(0, 0, 0, 0.05);\r\n\t}\r\n\t.handler {\r\n\t\tposition: relative;\r\n\t\tflex-grow: 1;\r\n\t\tcolor: white;\r\n\t}\r\n\t.button {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tcursor: pointer;\r\n\t\tborder: none;\r\n\t\tbackground-color: rgba(0, 0, 0, 0);\r\n\t\tfont-size: 14px;\r\n\t\tcolor: white;\r\n\t\tborder-radius: 0px;\r\n\t\tpadding: 2px 8px;\r\n\t\tmargin: 0px;\r\n\t\ttransition: background-color 0.25s;\r\n\t\t&:hover {\r\n\t\t\tbackground-color: rgba(0, 0, 0, 0.25);\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent, defineAsyncComponent } from \"vue\";\r\nimport { minimize, close } from \"@front/util_function/system\";\r\nconst HandlerMoving = defineAsyncComponent(() =>\r\n\timport(\"@front/components/system/HandlerMoving.vue\")\r\n);\r\nexport default defineComponent({\r\n\tname: \"topbarBase\",\r\n\tcomponents: {\r\n\t\tHandlerMoving\r\n\t},\r\n\tmethods: {\r\n\t\tminimize,\r\n\t\tclose\r\n\t}\r\n});\r\n","import { render } from \"./base.vue?vue&type=template&id=5f1e490e&scoped=true\"\nimport script from \"./base.vue?vue&type=script&lang=ts\"\nexport * from \"./base.vue?vue&type=script&lang=ts\"\n\nimport \"./base.vue?vue&type=style&index=0&id=5f1e490e&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-5f1e490e\"\n\nexport default script","\r\nimport { defineComponent } from \"vue\";\r\nimport Cookies from \"@front/util_function/cookies\";\r\nimport topbarBase from \"@front/components/system/topbars/base.vue\";\r\nimport {\r\n\tbackendRestart,\r\n\tloadConfig,\r\n\tlaunch\r\n} from \"@front/util_function/system\";\r\nimport { assign } from \"@front/util_function/base\";\r\nimport { isOnline } from \"@front/api/server\";\r\nimport { login as loginTexts, common } from \"@front/texts\";\r\nexport default defineComponent({\r\n\tname: \"login\",\r\n\tcomponents: {\r\n\t\ttopbarBase\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tuserData: {\r\n\t\t\t\taccount: \"\",\r\n\t\t\t\tpassword: \"\",\r\n\t\t\t\tkeepLogined: false,\r\n\t\t\t\tdisclaimerCheck: false\r\n\t\t\t},\r\n\t\t\tcommon: common(),\r\n\t\t\tdisclaimerDialog: false,\r\n\t\t\tlogining: false,\r\n\t\t\tloginFailedText: \"\",\r\n\t\t\twelcome: false,\r\n\t\t\twelcomeLogoKey: \"111\"\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tloginTexts,\r\n\t\tapi(): any {\r\n\t\t\treturn this.$store.state.api;\r\n\t\t},\r\n\t\tloginDisabled(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck ||\r\n\t\t\t\tthis.logining ||\r\n\t\t\t\tthis.$store.state.streamStatus.step === \"offline\"\r\n\t\t\t);\r\n\t\t},\r\n\t\tloginText(): string {\r\n\t\t\tif (this.logining) {\r\n\t\t\t\treturn \"登陆中...\";\r\n\t\t\t}\r\n\t\t\tif (this.loginFailedText) {\r\n\t\t\t\treturn `登陆失败： ${this.loginFailedText}`;\r\n\t\t\t}\r\n\t\t\tif (this.$store.state.streamStatus.step !== \"offline\") {\r\n\t\t\t\treturn \"服务端已连接\";\r\n\t\t\t}\r\n\t\t\treturn \"服务端离线\";\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.getCookie();\r\n\t\tthis.$store.dispatch(\"startServe\").then(() => {\r\n\t\t\tthis.autoLogin();\r\n\t\t});\r\n\t\tloadConfig().then((res: any) => {\r\n\t\t\tif (res) {\r\n\t\t\t\tassign(this.$store.state.danmakuProfile, res);\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\tres?.general?.streamToolEnable &&\r\n\t\t\t\tres?.general?.streamToolPath\r\n\t\t\t) {\r\n\t\t\t\tlaunch(res?.general?.streamToolPath);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tmethods: {\r\n\t\tautoLogin(): void {\r\n\t\t\tif (\r\n\t\t\t\tthis.getCookie() &&\r\n\t\t\t\tthis.userData.keepLogined &&\r\n\t\t\t\tsessionStorage.getItem(\"firstTime\") !== \"false\"\r\n\t\t\t) {\r\n\t\t\t\tthis.login();\r\n\t\t\t}\r\n\t\t},\r\n\t\tlogin() {\r\n\t\t\tif (!isOnline()) {\r\n\t\t\t\tthis.$store\r\n\t\t\t\t\t.dispatch(\"startServe\")\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tthis.login();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((error: any) => {\r\n\t\t\t\t\t\tconsole.error(error);\r\n\t\t\t\t\t\tbackendRestart();\r\n\t\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.logining = true;\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.$store\r\n\t\t\t\t.dispatch(\"login\", this.userData)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tthis.$store.state.userData = this.userData;\r\n\t\t\t\t\tsessionStorage.setItem(\"logined\", \"true\");\r\n\t\t\t\t\tsessionStorage.setItem(\"firstTime\", \"false\");\r\n\t\t\t\t\tif (this.userData.keepLogined) {\r\n\t\t\t\t\t\tthis.setCookie();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.welcomeLogoKey = String(Math.random());\r\n\t\t\t\t\tthis.welcome = true;\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tthis.$router.replace(\"dashboard\");\r\n\t\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\t}, 4000);\r\n\t\t\t\t})\r\n\t\t\t\t.catch((err: any) => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\tthis.loginFailedText = err;\r\n\t\t\t\t\t// backendRestart();\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tgetCookie() {\r\n\t\t\tconst userData = Cookies.get(\"userData\");\r\n\t\t\tif (!userData) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.userData = JSON.parse(userData);\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tsetCookie() {\r\n\t\t\tCookies.set(\"userData\", JSON.stringify(this.userData));\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tif (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=5dcd37bd&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=5dcd37bd&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-5dcd37bd\"\n\nexport default script"],"sourceRoot":""}