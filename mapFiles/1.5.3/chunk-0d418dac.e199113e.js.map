{"version":3,"sources":["webpack:///./src/electron_browser/views/danmakuWeb/index.vue?500d","webpack:///./src/electron_browser/views/danmakuWeb/index.vue","webpack:///./src/electron_browser/views/danmakuWeb/index.vue?a23d","webpack:///./src/electron_browser/views/danmakuWeb/index.vue?d067","webpack:///./src/electron_browser/components/superChat/index.vue?6813","webpack:///./src/electron_browser/components/superChat/index.vue","webpack:///./src/electron_browser/components/superChat/index.vue?04c7","webpack:///./src/electron_browser/components/superChat/index.vue?0dd8"],"names":["style","class","enable","superChatEnable","settings","danmakuProfile","web","danmakuList","danmakuSession","filterFlow","name","mode","pos","key","dotsCount","dot","checkers","checker","label","value","components","flow","superChatList","superChat","statusTimer","that","this","settingTimer","reconnect","status","isOnline","method","refresh","wait","registered","registerWS","logined","login","hasSession","requestSession","hasSetting","updateSettings","hasRank","isStreaming","requestStreaming","$store","state","isLogined","registerEvents","dispatch","then","unRegisterEvents","computed","Object","values","item","methods","clearTimeout","forEach","window","wsl","close","on","updateSession","updateRank","updateManager","checkServerState","off","Promise","resolve","account","password","streamStatus","step","statusLooper","startDanmaku","location","reload","next","time","setTimeout","res","finally","register","userSession","userID","wsEmit","Boolean","liveID","fetch","cache","json","common","temp","session","rank","managerList","list","length","push","mock","liverUID","type","data","danmuInfo","sendTime","userInfo","nickname","avatar","medal","uperID","clubName","level","managerType","content","i","render","superChatArray","scBlock","selectedID","superChatID","select","displayType","uid","sc-block","currentTime","remove","superChatBlock","listBlock","listPanel","timeCounter","count","update","Date","now","nextOne","find","block","showed","listEndTime","panelEndTime","filter","blockI","__scopeId"],"mappings":"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","file":"js/chunk-0d418dac.e199113e.js","sourcesContent":["export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=17eeece3&lang=scss\"","<template>\r\n\t<div style=\"width:100%;height:100%;position:relative\">\r\n\t\t<super-chat-list class=\"super-chat\" v-if=\"enable&&superChatEnable\" />\r\n\t\t<flow v-if=\"enable\" :class=\"{superChatEnable}\" :settings=\"danmakuProfile.web\" :danmakuList=\"danmakuSession.filterFlow\" />\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<div class=\"tips\" v-if=\"!enable\">\r\n\t\t\t\t<div class=\"positioner\" :class=\"pos\" v-for=\"pos in ['lt','rt','lb','rb']\" :key=\"pos\" />\r\n\t\t\t\t<div class=\"title\">弹幕准备中。<span v-for=\"dot in dotsCount\" :key=\"dot\">。</span></div>\r\n\t\t\t\t<div v-for=\"checker of checkers\" :key=\"checker.label\" class=\"checkers\">\r\n\t\t\t\t\t<div class=\"label\">{{checker.label}}</div>\r\n\t\t\t\t\t<div class=\"status\" :class=\"checker.value?'el-icon-circle-check success':'el-icon-circle-close failed'\" />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</transition>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { wsevent, user, server } from \"@front/api\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nimport { commonSettings } from \"@front/datas/danmaku\";\r\nimport { tempInfo } from \"@front/datas/temp\";\r\nimport flow from \"@front/components/danmakuFlow/index.vue\";\r\nimport { mapState, mapGetters } from \"vuex\";\r\nimport superChatList from \"@front/components/superChat/index.vue\";\r\nimport { registerRole } from \"@front/util_function/base\";\r\nimport { actions } from \"@front/store/actions\";\r\nexport default defineComponent({\r\n\tname: \"webDanmaku\",\r\n\tcomponents: {\r\n\t\tflow,\r\n\t\tsuperChatList\r\n\t},\r\n\tdata() {\r\n\t\tconst danmakuList: any = [];\r\n\t\tconst statusTimer: any = null;\r\n\t\t// @ts-ignore\r\n\t\tconst that: any = this;\r\n\t\treturn {\r\n\t\t\tdanmakuList,\r\n\t\t\tstatusTimer,\r\n\t\t\tsettingTimer: false,\r\n\t\t\tdotsCount: 0,\r\n\t\t\treconnect: false,\r\n\t\t\tstatus: {\r\n\t\t\t\tisOnline: {\r\n\t\t\t\t\tlabel: \"连接在线\",\r\n\t\t\t\t\tmethod: that.refresh,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 2000\r\n\t\t\t\t},\r\n\t\t\t\tregistered: {\r\n\t\t\t\t\tlabel: \"通信注册\",\r\n\t\t\t\t\tmethod: that.registerWS,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tlogined: {\r\n\t\t\t\t\tlabel: \"登陆\",\r\n\t\t\t\t\tmethod: that.login,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\thasSession: {\r\n\t\t\t\t\tlabel: \"主播信息\",\r\n\t\t\t\t\tmethod: that.requestSession,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\thasSetting: {\r\n\t\t\t\t\tlabel: \"弹幕设置\",\r\n\t\t\t\t\tmethod: that.updateSettings,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\thasRank: {\r\n\t\t\t\t\tlabel: \"牌子信息\",\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tisStreaming: {\r\n\t\t\t\t\tlabel: \"直播启动\",\r\n\t\t\t\t\tmethod: that.requestStreaming,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.$store.state.isLogined = true;\r\n\t\tthis.registerEvents();\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$store.dispatch(\"startServe\").then(() => {\r\n\t\t\tthis.registerWS();\r\n\t\t});\r\n\t\tregisterRole(\"网页端\");\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tthis.unRegisterEvents();\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters([\"superChatEnable\"]),\r\n\t\t...mapState([\r\n\t\t\t\"userSession\",\r\n\t\t\t\"danmakuProfile\",\r\n\t\t\t\"rank\",\r\n\t\t\t\"streamStatus\",\r\n\t\t\t\"danmakuSession\"\r\n\t\t]),\r\n\t\tcheckers(): Array<any> {\r\n\t\t\treturn Object.values(this.status);\r\n\t\t},\r\n\t\tenable(): boolean {\r\n\t\t\tfor (const item of Object.values(this.status)) {\r\n\t\t\t\tif (!item.value) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trefresh() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.checkers.forEach((checker: any) => {\r\n\t\t\t\tchecker.value = false;\r\n\t\t\t});\r\n\t\t\tif (server.isOnline()) {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\twindow.wsl.close();\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterEvents() {\r\n\t\t\twsevent.on(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.on(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.on(\"update-manager\", this.updateManager);\r\n\t\t\twsevent.on(\"registered\", () => {\r\n\t\t\t\tthis.status.registered.value = true;\r\n\t\t\t});\r\n\t\t\tevent.on(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tunRegisterEvents() {\r\n\t\t\twsevent.off(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.off(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.off(\"update-manager\", this.updateManager);\r\n\t\t\tevent.off(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tlogin() {\r\n\t\t\treturn new Promise(resolve => {\r\n\t\t\t\tuser.login({\r\n\t\t\t\t\taccount: \"\",\r\n\t\t\t\t\tpassword: \"\"\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\tthis.status.logined.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tcheckServerState() {\r\n\t\t\tswitch (this.streamStatus.step) {\r\n\t\t\t\tcase \"online\":\r\n\t\t\t\t\tthis.status.isOnline.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"danmakuing\":\r\n\t\t\t\t\tthis.startDanmaku();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"streamEnded\":\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tstatusLooper() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.dotsCount = (this.dotsCount + 1) % 4;\r\n\t\t\tconst next = (time = 500) => {\r\n\t\t\t\tthis.statusTimer = setTimeout(() => {\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t}, time);\r\n\t\t\t};\r\n\t\t\tfor (const checker of this.checkers) {\r\n\t\t\t\tif (!checker.value) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (checker.method) {\r\n\t\t\t\t\t\tconst res = checker.method();\r\n\t\t\t\t\t\tif (res instanceof Promise) {\r\n\t\t\t\t\t\t\tres.finally(() => {\r\n\t\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnext(checker.wait);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterWS() {\r\n\t\t\twsevent.register(\"client\");\r\n\t\t},\r\n\t\trequestSession() {\r\n\t\t\tif (!this.userSession.userID) {\r\n\t\t\t\twsevent.wsEmit(\"get-session\", {}, \"server\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\trequestSettings() {\r\n\t\t\twsevent.wsEmit(\"get-settings\", {}, \"server\");\r\n\t\t},\r\n\t\trequestStreaming() {\r\n\t\t\treturn this.$store.dispatch(\"streamable\").then((res: any) => {\r\n\t\t\t\tthis.status.isStreaming.value = Boolean(res.liveID);\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateSettings() {\r\n\t\t\tif (this.settingTimer) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.settingTimer = true;\r\n\t\t\tfetch(\"/configFiles/config.json\", {\r\n\t\t\t\tcache: \"no-cache\"\r\n\t\t\t})\r\n\t\t\t\t.then((res: any) => res.json())\r\n\t\t\t\t.then((json: any) => {\r\n\t\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.web = json.web;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.common =\r\n\t\t\t\t\t\tjson.common || commonSettings();\r\n\t\t\t\t\tthis.$store.state.temp = tempInfo();\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.settingTimer = false;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tupdateSession(session: any) {\r\n\t\t\tif (\r\n\t\t\t\tthis.status.hasSession.value &&\r\n\t\t\t\tthis.userSession.userID !== session.userID\r\n\t\t\t) {\r\n\t\t\t\tthis.refresh();\r\n\t\t\t}\r\n\t\t\tif ((this.status.hasSession.value = Boolean(session))) {\r\n\t\t\t\tthis.$store.state.userSession = session;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateRank(rank: any) {\r\n\t\t\tif ((this.status.hasRank.value = Boolean(rank))) {\r\n\t\t\t\tthis.$store.state.rank = rank;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateManager(res: any) {\r\n\t\t\tthis.$store.state.managerList = res.list;\r\n\t\t},\r\n\t\tstartDanmaku() {\r\n\t\t\tif (!this.danmakuSession.filterFlow.length) {\r\n\t\t\t\tthis.danmakuSession.filterFlow.push({\r\n\t\t\t\t\tmock: true,\r\n\t\t\t\t\tliverUID: 23682490,\r\n\t\t\t\t\ttype: 1000,\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tdanmuInfo: {\r\n\t\t\t\t\t\t\tsendTime: 1618750176864,\r\n\t\t\t\t\t\t\tuserInfo: {\r\n\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\tnickname: \"ACFUN前后端开源⑨课\",\r\n\t\t\t\t\t\t\t\tavatar:\r\n\t\t\t\t\t\t\t\t\t\"https://tx-free-imgs.acfun.cn/FllI0yyjNgQ61QdJJdbIh9cRQIYY?imageMogr2/auto-orient/format/webp/quality/75!/ignore-error/1\",\r\n\t\t\t\t\t\t\t\tmedal: {\r\n\t\t\t\t\t\t\t\t\tuperID: 23682490,\r\n\t\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\t\tclubName: \"ACER\",\r\n\t\t\t\t\t\t\t\t\tlevel: 999\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tmanagerType: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcontent: \"弹幕流启动成功！直播开始啦开始啦！\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\treWait() {\r\n\t\t\t[\"hasSession\", \"isStreaming\", \"hasRank\", \"danmakuing\"].forEach(\r\n\t\t\t\t(i: any) => {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tthis.status[i].value = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n<style lang='scss'>\r\n@import \"@front/styles/variables.scss\";\r\nhtml,\r\nbody,\r\n#app {\r\n\tbackground-color: transparent;\r\n\tmin-width: 0px;\r\n\tmin-height: 0px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tpadding: 0px;\r\n}\r\n#app {\r\n\tmargin: 0px;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\ttransition: none;\r\n}\r\n.danmaku-flow {\r\n\tpadding-bottom: 16px !important;\r\n}\r\n.superChatEnable {\r\n\theight: calc(100% - 40px);\r\n}\r\n.super-chat {\r\n\tborder: none !important;\r\n\tmargin-bottom: 5px;\r\n}\r\n.tips {\r\n\tposition: absolute;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tcolor: white;\r\n\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\tfont-weight: 700;\r\n\tfont-size: 24px;\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\t.title {\r\n\t\tfont-size: 32px;\r\n\t\tmargin-bottom: 15px;\r\n\t\tmargin-left: 50px;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.checkers {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 15px;\r\n\t\t.failed {\r\n\t\t\tcolor: $--color-danger;\r\n\t\t}\r\n\t\t.success {\r\n\t\t\tcolor: $--color-success;\r\n\t\t}\r\n\t\t.label {\r\n\t\t\twidth: 150px;\r\n\t\t}\r\n\t}\r\n\t.positioner {\r\n\t\tposition: absolute;\r\n\t\tborder-style: solid;\r\n\t\tborder-color: white;\r\n\t\theight: 5%;\r\n\t\twidth: 5%;\r\n\r\n\t\t&.lt {\r\n\t\t\ttop: 0px;\r\n\t\t\tleft: 0px;\r\n\t\t\tborder-width: 5px 0px 0px 5px;\r\n\t\t}\r\n\t\t&.rt {\r\n\t\t\ttop: 0px;\r\n\t\t\tright: 0px;\r\n\t\t\tborder-width: 5px 5px 0px 0px;\r\n\t\t}\r\n\t\t&.lb {\r\n\t\t\tbottom: 0px;\r\n\t\t\tleft: 0px;\r\n\t\t\tborder-width: 0px 0px 5px 5px;\r\n\t\t}\r\n\t\t&.rb {\r\n\t\t\tbottom: 0px;\r\n\t\t\tright: 0px;\r\n\t\t\tborder-width: 0px 5px 5px 0px;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from \"vue\";\r\nimport { wsevent, user, server } from \"@front/api\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nimport { commonSettings } from \"@front/datas/danmaku\";\r\nimport { tempInfo } from \"@front/datas/temp\";\r\nimport flow from \"@front/components/danmakuFlow/index.vue\";\r\nimport { mapState, mapGetters } from \"vuex\";\r\nimport superChatList from \"@front/components/superChat/index.vue\";\r\nimport { registerRole } from \"@front/util_function/base\";\r\nimport { actions } from \"@front/store/actions\";\r\nexport default defineComponent({\r\n\tname: \"webDanmaku\",\r\n\tcomponents: {\r\n\t\tflow,\r\n\t\tsuperChatList\r\n\t},\r\n\tdata() {\r\n\t\tconst danmakuList: any = [];\r\n\t\tconst statusTimer: any = null;\r\n\t\t// @ts-ignore\r\n\t\tconst that: any = this;\r\n\t\treturn {\r\n\t\t\tdanmakuList,\r\n\t\t\tstatusTimer,\r\n\t\t\tsettingTimer: false,\r\n\t\t\tdotsCount: 0,\r\n\t\t\treconnect: false,\r\n\t\t\tstatus: {\r\n\t\t\t\tisOnline: {\r\n\t\t\t\t\tlabel: \"连接在线\",\r\n\t\t\t\t\tmethod: that.refresh,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 2000\r\n\t\t\t\t},\r\n\t\t\t\tregistered: {\r\n\t\t\t\t\tlabel: \"通信注册\",\r\n\t\t\t\t\tmethod: that.registerWS,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tlogined: {\r\n\t\t\t\t\tlabel: \"登陆\",\r\n\t\t\t\t\tmethod: that.login,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\thasSession: {\r\n\t\t\t\t\tlabel: \"主播信息\",\r\n\t\t\t\t\tmethod: that.requestSession,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\thasSetting: {\r\n\t\t\t\t\tlabel: \"弹幕设置\",\r\n\t\t\t\t\tmethod: that.updateSettings,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 1500\r\n\t\t\t\t},\r\n\t\t\t\thasRank: {\r\n\t\t\t\t\tlabel: \"牌子信息\",\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t},\r\n\t\t\t\tisStreaming: {\r\n\t\t\t\t\tlabel: \"直播启动\",\r\n\t\t\t\t\tmethod: that.requestStreaming,\r\n\t\t\t\t\tvalue: false,\r\n\t\t\t\t\twait: 500\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.$store.state.isLogined = true;\r\n\t\tthis.registerEvents();\r\n\t},\r\n\tmounted() {\r\n\t\tthis.$store.dispatch(\"startServe\").then(() => {\r\n\t\t\tthis.registerWS();\r\n\t\t});\r\n\t\tregisterRole(\"网页端\");\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tthis.unRegisterEvents();\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapGetters([\"superChatEnable\"]),\r\n\t\t...mapState([\r\n\t\t\t\"userSession\",\r\n\t\t\t\"danmakuProfile\",\r\n\t\t\t\"rank\",\r\n\t\t\t\"streamStatus\",\r\n\t\t\t\"danmakuSession\"\r\n\t\t]),\r\n\t\tcheckers(): Array<any> {\r\n\t\t\treturn Object.values(this.status);\r\n\t\t},\r\n\t\tenable(): boolean {\r\n\t\t\tfor (const item of Object.values(this.status)) {\r\n\t\t\t\tif (!item.value) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\trefresh() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.checkers.forEach((checker: any) => {\r\n\t\t\t\tchecker.value = false;\r\n\t\t\t});\r\n\t\t\tif (server.isOnline()) {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\twindow.wsl.close();\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterEvents() {\r\n\t\t\twsevent.on(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.on(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.on(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.on(\"update-manager\", this.updateManager);\r\n\t\t\twsevent.on(\"registered\", () => {\r\n\t\t\t\tthis.status.registered.value = true;\r\n\t\t\t});\r\n\t\t\tevent.on(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tunRegisterEvents() {\r\n\t\t\twsevent.off(\"update-style\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-settings\", this.updateSettings);\r\n\t\t\twsevent.off(\"update-session\", this.updateSession); // rank 由服务器定期发送\r\n\t\t\twsevent.off(\"update-rank\", this.updateRank);\r\n\t\t\twsevent.off(\"update-manager\", this.updateManager);\r\n\t\t\tevent.off(\"streamStatusChanged\", this.checkServerState);\r\n\t\t},\r\n\t\tlogin() {\r\n\t\t\treturn new Promise(resolve => {\r\n\t\t\t\tuser.login({\r\n\t\t\t\t\taccount: \"\",\r\n\t\t\t\t\tpassword: \"\"\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\tthis.status.logined.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tresolve(true);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tcheckServerState() {\r\n\t\t\tswitch (this.streamStatus.step) {\r\n\t\t\t\tcase \"online\":\r\n\t\t\t\t\tthis.status.isOnline.value = true;\r\n\t\t\t\t\tthis.registerWS();\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"danmakuing\":\r\n\t\t\t\t\tthis.startDanmaku();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"streamEnded\":\r\n\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tstatusLooper() {\r\n\t\t\tclearTimeout(this.statusTimer);\r\n\t\t\tthis.dotsCount = (this.dotsCount + 1) % 4;\r\n\t\t\tconst next = (time = 500) => {\r\n\t\t\t\tthis.statusTimer = setTimeout(() => {\r\n\t\t\t\t\tthis.statusLooper();\r\n\t\t\t\t}, time);\r\n\t\t\t};\r\n\t\t\tfor (const checker of this.checkers) {\r\n\t\t\t\tif (!checker.value) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (checker.method) {\r\n\t\t\t\t\t\tconst res = checker.method();\r\n\t\t\t\t\t\tif (res instanceof Promise) {\r\n\t\t\t\t\t\t\tres.finally(() => {\r\n\t\t\t\t\t\t\t\tnext();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnext(checker.wait);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnext();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tregisterWS() {\r\n\t\t\twsevent.register(\"client\");\r\n\t\t},\r\n\t\trequestSession() {\r\n\t\t\tif (!this.userSession.userID) {\r\n\t\t\t\twsevent.wsEmit(\"get-session\", {}, \"server\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t}\r\n\t\t},\r\n\t\trequestSettings() {\r\n\t\t\twsevent.wsEmit(\"get-settings\", {}, \"server\");\r\n\t\t},\r\n\t\trequestStreaming() {\r\n\t\t\treturn this.$store.dispatch(\"streamable\").then((res: any) => {\r\n\t\t\t\tthis.status.isStreaming.value = Boolean(res.liveID);\r\n\t\t\t});\r\n\t\t},\r\n\t\tupdateSettings() {\r\n\t\t\tif (this.settingTimer) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.settingTimer = true;\r\n\t\t\tfetch(\"/configFiles/config.json\", {\r\n\t\t\t\tcache: \"no-cache\"\r\n\t\t\t})\r\n\t\t\t\t.then((res: any) => res.json())\r\n\t\t\t\t.then((json: any) => {\r\n\t\t\t\t\tthis.status.hasSetting.value = true;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.web = json.web;\r\n\t\t\t\t\tthis.$store.state.danmakuProfile.common =\r\n\t\t\t\t\t\tjson.common || commonSettings();\r\n\t\t\t\t\tthis.$store.state.temp = tempInfo();\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tthis.settingTimer = false;\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tupdateSession(session: any) {\r\n\t\t\tif (\r\n\t\t\t\tthis.status.hasSession.value &&\r\n\t\t\t\tthis.userSession.userID !== session.userID\r\n\t\t\t) {\r\n\t\t\t\tthis.refresh();\r\n\t\t\t}\r\n\t\t\tif ((this.status.hasSession.value = Boolean(session))) {\r\n\t\t\t\tthis.$store.state.userSession = session;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateRank(rank: any) {\r\n\t\t\tif ((this.status.hasRank.value = Boolean(rank))) {\r\n\t\t\t\tthis.$store.state.rank = rank;\r\n\t\t\t}\r\n\t\t},\r\n\t\tupdateManager(res: any) {\r\n\t\t\tthis.$store.state.managerList = res.list;\r\n\t\t},\r\n\t\tstartDanmaku() {\r\n\t\t\tif (!this.danmakuSession.filterFlow.length) {\r\n\t\t\t\tthis.danmakuSession.filterFlow.push({\r\n\t\t\t\t\tmock: true,\r\n\t\t\t\t\tliverUID: 23682490,\r\n\t\t\t\t\ttype: 1000,\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tdanmuInfo: {\r\n\t\t\t\t\t\t\tsendTime: 1618750176864,\r\n\t\t\t\t\t\t\tuserInfo: {\r\n\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\tnickname: \"ACFUN前后端开源⑨课\",\r\n\t\t\t\t\t\t\t\tavatar:\r\n\t\t\t\t\t\t\t\t\t\"https://tx-free-imgs.acfun.cn/FllI0yyjNgQ61QdJJdbIh9cRQIYY?imageMogr2/auto-orient/format/webp/quality/75!/ignore-error/1\",\r\n\t\t\t\t\t\t\t\tmedal: {\r\n\t\t\t\t\t\t\t\t\tuperID: 23682490,\r\n\t\t\t\t\t\t\t\t\tuserID: 1,\r\n\t\t\t\t\t\t\t\t\tclubName: \"ACER\",\r\n\t\t\t\t\t\t\t\t\tlevel: 999\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tmanagerType: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcontent: \"弹幕流启动成功！直播开始啦开始啦！\"\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\treWait() {\r\n\t\t\t[\"hasSession\", \"isStreaming\", \"hasRank\", \"danmakuing\"].forEach(\r\n\t\t\t\t(i: any) => {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tthis.status[i].value = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=17eeece3\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=17eeece3&lang=scss\"\nscript.render = render\n\nexport default script","export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=3c0b1be0&scoped=true&lang=scss\"","<template>\r\n\t<div class=\"super-chat-list\">\r\n\t\t<div class=\"super-chat-list-row\">\r\n\t\t\t<list-block :selectedID=\"temp.superChatID\" @click=\"select(scBlock,5000)\" :displayType=\"displayType\" v-for=\"scBlock in temp.superChatArray\" :key=\"scBlock.uid\" :sc-block=\"scBlock\" :currentTime=\"currentTime\" @end=\"remove(scBlock)\" />\r\n\t\t</div>\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<list-panel class=\"super-chat-panel\" :displayType=\"displayType\" :key=\"temp.superChatID\" v-if=\"temp.superChatBlock\" :sc-block=\"temp.superChatBlock\" :currentTime=\"currentTime\" @next=\"next()\" />\r\n\t\t</transition>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport { mapState } from \"vuex\";\r\nimport listBlock from \"./listBlock.vue\";\r\nimport listPanel from \"./listPanel.vue\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nexport default defineComponent({\r\n\tname: \"superChatList\",\r\n\tcomponents: { listBlock, listPanel },\r\n\tdata() {\r\n\t\tconst timeCounter: any = null;\r\n\t\treturn {\r\n\t\t\tcurrentTime: 0,\r\n\t\t\ttimeCounter\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.count();\r\n\t\tevent.on(\"super-chat-updated\", this.update);\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearTimeout(this.timeCounter);\r\n\t\tevent.off(\"super-chat-updated\", this.update);\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState([\"temp\", \"danmakuProfile\"]),\r\n\t\tsuperChatArray(): Array<any> {\r\n\t\t\treturn this.temp.superChatArray;\r\n\t\t},\r\n\t\tdisplayType(): number {\r\n\t\t\treturn this.danmakuProfile.common?.superChat?.displayType || 0;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tupdate() {\r\n\t\t\tif (this.temp.superChatID) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.next();\r\n\t\t},\r\n\t\tcount() {\r\n\t\t\tclearTimeout(this.timeCounter);\r\n\t\t\tthis.currentTime = Date.now();\r\n\t\t\tthis.timeCounter = setTimeout(() => {\r\n\t\t\t\tthis.count();\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\t\tnext() {\r\n\t\t\tconst nextOne = this.temp.superChatArray.find(\r\n\t\t\t\t(block: any) => !block?.showed\r\n\t\t\t);\r\n\t\t\tif (\r\n\t\t\t\t!nextOne &&\r\n\t\t\t\tthis.currentTime > this.temp.superChatBlock.listEndTime\r\n\t\t\t) {\r\n\t\t\t\tthis.temp.superChatID = 0;\r\n\t\t\t\tthis.temp.superChatBlock = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.select(nextOne);\r\n\t\t\t}\r\n\t\t},\r\n\t\tselect(block: any, time = 20000) {\r\n\t\t\tblock.showed = true;\r\n\t\t\tblock.panelEndTime = Date.now() + time;\r\n\t\t\tif (block.listEndTime < block.panelEndTime) {\r\n\t\t\t\tblock.listEndTime = block.panelEndTime;\r\n\t\t\t}\r\n\t\t\tthis.temp.superChatID = block.uid;\r\n\t\t\tthis.temp.superChatBlock = block;\r\n\t\t},\r\n\t\tremove(block: any) {\r\n\t\t\tthis.temp.superChatArray = this.temp.superChatArray.filter(\r\n\t\t\t\t(blockI: any) => blockI !== block\r\n\t\t\t);\r\n\t\t\tif (block.uid === this.temp.superChatID) {\r\n\t\t\t\tthis.next();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped lang='scss'>\r\n@import \"@front/styles/variables.scss\";\r\n.super-chat-list {\r\n\tposition: relative;\r\n\twidth: 100%;\r\n\theight: 35px;\r\n\tbox-sizing: border-box;\r\n\tborder: $--border-base;\r\n\t.super-chat-list-row {\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tflex-wrap: wrap;\r\n\t\toverflow: hidden;\r\n\t\tpadding-left: 8px;\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent } from \"vue\";\r\nimport { mapState } from \"vuex\";\r\nimport listBlock from \"./listBlock.vue\";\r\nimport listPanel from \"./listPanel.vue\";\r\nimport { event } from \"@front/util_function/eventBus\";\r\nexport default defineComponent({\r\n\tname: \"superChatList\",\r\n\tcomponents: { listBlock, listPanel },\r\n\tdata() {\r\n\t\tconst timeCounter: any = null;\r\n\t\treturn {\r\n\t\t\tcurrentTime: 0,\r\n\t\t\ttimeCounter\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tthis.count();\r\n\t\tevent.on(\"super-chat-updated\", this.update);\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearTimeout(this.timeCounter);\r\n\t\tevent.off(\"super-chat-updated\", this.update);\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState([\"temp\", \"danmakuProfile\"]),\r\n\t\tsuperChatArray(): Array<any> {\r\n\t\t\treturn this.temp.superChatArray;\r\n\t\t},\r\n\t\tdisplayType(): number {\r\n\t\t\treturn this.danmakuProfile.common?.superChat?.displayType || 0;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tupdate() {\r\n\t\t\tif (this.temp.superChatID) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.next();\r\n\t\t},\r\n\t\tcount() {\r\n\t\t\tclearTimeout(this.timeCounter);\r\n\t\t\tthis.currentTime = Date.now();\r\n\t\t\tthis.timeCounter = setTimeout(() => {\r\n\t\t\t\tthis.count();\r\n\t\t\t}, 1000);\r\n\t\t},\r\n\t\tnext() {\r\n\t\t\tconst nextOne = this.temp.superChatArray.find(\r\n\t\t\t\t(block: any) => !block?.showed\r\n\t\t\t);\r\n\t\t\tif (\r\n\t\t\t\t!nextOne &&\r\n\t\t\t\tthis.currentTime > this.temp.superChatBlock.listEndTime\r\n\t\t\t) {\r\n\t\t\t\tthis.temp.superChatID = 0;\r\n\t\t\t\tthis.temp.superChatBlock = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.select(nextOne);\r\n\t\t\t}\r\n\t\t},\r\n\t\tselect(block: any, time = 20000) {\r\n\t\t\tblock.showed = true;\r\n\t\t\tblock.panelEndTime = Date.now() + time;\r\n\t\t\tif (block.listEndTime < block.panelEndTime) {\r\n\t\t\t\tblock.listEndTime = block.panelEndTime;\r\n\t\t\t}\r\n\t\t\tthis.temp.superChatID = block.uid;\r\n\t\t\tthis.temp.superChatBlock = block;\r\n\t\t},\r\n\t\tremove(block: any) {\r\n\t\t\tthis.temp.superChatArray = this.temp.superChatArray.filter(\r\n\t\t\t\t(blockI: any) => blockI !== block\r\n\t\t\t);\r\n\t\t\tif (block.uid === this.temp.superChatID) {\r\n\t\t\t\tthis.next();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=3c0b1be0&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=3c0b1be0&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-3c0b1be0\"\n\nexport default script"],"sourceRoot":""}